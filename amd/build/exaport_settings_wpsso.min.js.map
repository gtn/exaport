{"version":3,"file":"exaport_settings_wpsso.min.js","sources":["../src/exaport_settings_wpsso.js"],"sourcesContent":["\ndefine(['jquery', 'core/notification', 'core/toast'], function($, notification, toast) {\n\n  const init = () => {\n\n    $('#admin-block_exaport_button_with_js').hide();\n    checkEnabledWpSSO();\n\n    $('body').on('click', '.block_exaport_request_wp_sso_passphrase, .block_exaport_remove_passphrase, .block_exaport_test_passphrase', function (e) {\n      e.preventDefault();\n\n      var theButton = $(this);\n\n      var action = '-NO-';\n      if (theButton.hasClass('block_exaport_request_wp_sso_passphrase')) {\n        action = 'requestPassphrase';\n      } else if (theButton.hasClass('block_exaport_remove_passphrase')) {\n        action = 'removePassphrase';\n      } else if (theButton.hasClass('block_exaport_test_passphrase')) {\n        action = 'testPassphrase';\n      }\n\n      var data = {\n        wpAction: 1,\n        action: action\n      };\n\n      switch (action) {\n        case 'requestPassphrase':\n          var secret = $.trim($('.block_exaport_secret_input').val());\n          if (!secret) {\n            alert('Enter the secret!');\n            return false;\n          }\n          data.secret = secret;\n          break;\n        case 'removePassphrase':\n          break;\n        case 'testPassphrase':\n          break;\n      }\n\n      $.ajax({\n        url: M.cfg.wwwroot + '/blocks/exaport/importexport.php',\n        type: 'POST',\n        dataType: 'json',\n        data: data,\n        xhrFields: { withCredentials: true }   // keep Moodle session\n      })\n        .done(function (data) {\n          if (data.result === 'success') {\n            $('.block_exaport_message').replaceWith(data.html);\n          } else if (data.result === 'alert') {\n            toast.add(data.message, {\n              type: 'success',       // 'success' | 'info' | 'warning' | 'danger'\n              autohide: true,        // disappears after a few seconds\n            });\n            /*notification.alert(\n              'Done',\n              data.message,\n              'Close'\n            );*/\n\n          } else if (data.result === 'error') {\n            toast.add('Error <br>' + data.message, {\n              type: 'danger',       // 'success' | 'info' | 'warning' | 'danger'\n              autohide: false,        // disappears after a few seconds\n              closeButton: true,\n            });\n            /*notification.alert(\n              'Done',\n              'Error: ' + data.message,\n              'Close'\n            );*/\n            // alert('Error: ' + data.message);\n          }\n        })\n        .fail(function (jqXHR, textStatus, errorThrown) {\n          toast.add('Something went wrong!', {\n            type: 'danger',       // 'success' | 'info' | 'warning' | 'danger'\n            autohide: false,        // disappears after a few seconds\n            closeButton: true,\n          });\n          console.log('error:', errorThrown, 'code: 1745419297633');\n          // alert('Something was wrong!');\n        });\n    });\n\n\n    $('body').on('change', '#id_s__block_exaport_wp_sso_enabled', function(e) {\n      checkEnabledWpSSO();\n    })\n\n    function checkEnabledWpSSO() {\n\n      var theValue = $('#id_s__block_exaport_wp_sso_enabled').prop('checked');\n\n      var relatedOptions = ['admin-block_exaport_wp_sso_url', 'admin-block_exaport_wp_sso_passphrase'];\n\n      if (theValue) {\n        // show related options\n        $(relatedOptions).each(function(i, elementId) {\n          $('#'+elementId).show(50);\n        })\n      } else {\n        // hide related options\n        $(relatedOptions).each(function(i, elementId) {\n          $('#'+elementId).hide(50);\n        })\n      }\n\n    }\n\n\n  };\n\n  return { init };\n});\n\n"],"names":["define","$","notification","toast","init","checkEnabledWpSSO","relatedOptions","prop","each","i","elementId","show","hide","on","e","preventDefault","theButton","this","action","hasClass","data","wpAction","secret","trim","val","alert","ajax","url","M","cfg","wwwroot","type","dataType","xhrFields","withCredentials","done","result","replaceWith","html","add","message","autohide","closeButton","fail","jqXHR","textStatus","errorThrown","console","log"],"mappings":"AACAA,8CAAO,CAAC,SAAU,oBAAqB,eAAe,SAASC,EAAGC,aAAcC,aAmHvE,CAAEC,KAjHI,cA0FFC,wBAIHC,eAAiB,CAAC,iCAAkC,yCAFzCL,EAAE,uCAAuCM,KAAK,WAM3DN,EAAEK,gBAAgBE,MAAK,SAASC,EAAGC,WACjCT,EAAE,IAAIS,WAAWC,KAAK,OAIxBV,EAAEK,gBAAgBE,MAAK,SAASC,EAAGC,WACjCT,EAAE,IAAIS,WAAWE,KAAK,OAtG5BX,EAAE,uCAAuCW,OACzCP,oBAEAJ,EAAE,QAAQY,GAAG,QAAS,8GAA8G,SAAUC,GAC5IA,EAAEC,qBAEEC,UAAYf,EAAEgB,MAEdC,OAAS,OACTF,UAAUG,SAAS,2CACrBD,OAAS,oBACAF,UAAUG,SAAS,mCAC5BD,OAAS,mBACAF,UAAUG,SAAS,mCAC5BD,OAAS,sBAGPE,KAAO,CACTC,SAAU,EACVH,OAAQA,WAIH,sBADCA,YAEAI,OAASrB,EAAEsB,KAAKtB,EAAE,+BAA+BuB,WAChDF,cACHG,MAAM,sBACC,EAETL,KAAKE,OAASA,OAQlBrB,EAAEyB,KAAK,CACLC,IAAKC,EAAEC,IAAIC,QAAU,mCACrBC,KAAM,OACNC,SAAU,OACVZ,KAAMA,KACNa,UAAW,CAAEC,iBAAiB,KAE7BC,MAAK,SAAUf,MACM,YAAhBA,KAAKgB,OACPnC,EAAE,0BAA0BoC,YAAYjB,KAAKkB,MACpB,UAAhBlB,KAAKgB,OACdjC,MAAMoC,IAAInB,KAAKoB,QAAS,CACtBT,KAAM,UACNU,UAAU,IAQa,UAAhBrB,KAAKgB,QACdjC,MAAMoC,IAAI,aAAenB,KAAKoB,QAAS,CACrCT,KAAM,SACNU,UAAU,EACVC,aAAa,OAUlBC,MAAK,SAAUC,MAAOC,WAAYC,aACjC3C,MAAMoC,IAAI,wBAAyB,CACjCR,KAAM,SACNU,UAAU,EACVC,aAAa,IAEfK,QAAQC,IAAI,SAAUF,YAAa,6BAMzC7C,EAAE,QAAQY,GAAG,SAAU,uCAAuC,SAASC,GACrET"}