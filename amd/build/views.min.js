var exaportViewEdit,newItem=null,lastclicked=null;define("block_exaport/views",["jquery","jqueryui","block_exaport/touchpunch","core/modal_factory","core/modal_events"],(function($,jqui,jquitp,modalFactory,modalEvents){var dialogue,helpDialogue,defaultModalOptions={title:"test title",body:"",footer:""};function resetElementStates(){$(".portfolioOptions li").removeClass("selected"),$(".portfolioDesignBlocks > li").each((function(){$(".portfolioOptions li[itemid="+$(this).data("portfolio").itemid+"]").addClass("selected")}))}function updateBlockData(){var blocks=[];$(".portfolioDesignBlocks").each((function(positionx){$(this).children("li:visible").not(".block-placeholder").each((function(positiony){blocks.push($.extend($(this).data("portfolio"),{positionx:positionx+1,positiony:positiony+1}))}))})),$("form :input[name=blocks]").val(JSON.stringify(blocks))}function generateItem(type,data){var $item;if("new"==type?($item=$("<li></li>")).data("portfolio",data):($item=$(data),(data=$item.data("portfolio"))||(data={},$item.attr("itemid")?(data.type="item",data.itemid=$item.attr("itemid")):(data.type=$item.attr("block-type"),$item.attr("text")&&(data.text=$item.attr("text")),$item.attr("block_title")&&(data.block_title=$item.attr("block_title")),$item.attr("firstname")&&(data.firstname=$item.attr("firstname")),$item.attr("lastname")&&(data.lastname=$item.attr("lastname")),$item.attr("picture")&&(data.picture=$item.attr("picture")),$item.attr("email")&&(data.email=$item.attr("email"))),$item.data("portfolio",data))),$item.addClass("item"),$item.css("position","relative"),void 0===portfolioItems)var portfolioItems=window.portfolioItems;var $E=window.block_exaport;if(data.itemid&&!data.item&&portfolioItems&&portfolioItems[data.itemid]&&(data.item=portfolioItems[data.itemid]),"item"==data.type&&data.itemid&&data.item){var item_data=data.item,ilink=item_data.link;""!=ilink&&(ilink=$E.translate("link")+": "+ilink+"<br />");var itemPictures="";if(item_data.filescount>1){var imgWidth=40;item_data.filescount>3&&(imgWidth=35),item_data.filescount>5&&(imgWidth=30),itemPictures+='<div class="pictureset" style="float:right; position: relative; text-align: right; max-width: 150px;">';for(var imi=0;imi<item_data.filescount;imi++)imi&&imi%5==0&&(itemPictures+="<br />"),itemPictures+='<div class="picture" style="float:right; height: '+imgWidth+"px; width: "+imgWidth+'px;">',itemPictures+='<img style="max-width: 100%; max-height: 100%;" src="'+M.cfg.wwwroot+"/blocks/exaport/item_thumb.php?item_id="+item_data.id+"&imindex="+imi+'">',itemPictures+="</div>";itemPictures+="</div>"}else itemPictures+='<div class="picture" style="float:right; position: relative; height: 100px; width: 100px;">',itemPictures+='<img style="max-width: 100%; max-height: 100%;" src="'+M.cfg.wwwroot+"/blocks/exaport/item_thumb.php?item_id="+item_data.id+'">',itemPictures+="</div>";var tempString="";tempString+='<div id="id_holder" style="display:none;"></div> ',tempString+='<div class="item_info" style="overflow: hidden;">',tempString+='<div class="header">'+$E.translate("viewitem")+": "+item_data.name+"</div>",tempString+=itemPictures,tempString+='<div class="body">'+$E.translate("type")+": "+$E.translate(item_data.type)+"<br />",tempString+=$E.translate("category")+": "+item_data.category+"<br />"+ilink,tempString+=$E.translate("comments")+": "+item_data.comments+'<div class="exaport-item-intro"></div>',item_data.competences&&(tempString+='<script type="text/javascript" src="javascript/wz_tooltip.js"><\/script><a onmouseover="Tip(\''+item_data.competences+'\')" onmouseout="UnTip()"><img src="'+M.cfg.wwwroot+'/pix/t/grades.png" class="iconsmall" alt="competences" /></a>'),tempString+="</div></div>",$item.html(tempString),item_data.competences||$item.find(".exaport-item-intro").html(item_data.intro)}else if("personal_information"==data.type){tempString='<div id="id_holder" style="display:none;"></div>';tempString+='<div class="personal_info" style="overflow: hidden;">',tempString+='<div class="header">'+$E.translate("personalinformation")+": </div>",tempString+='<div class="picture" style="float:right; position: relative;"></div>',tempString+='<div class="name"></div>',tempString+='<div class="email"></div>',tempString+='<div class="body"></div>',tempString+="</div>",$item.html(tempString),$item.find("div.header").append(data.block_title),""!=data.picture&&null!=data.picture&&$item.find("div.picture").append('<img src="'+data.picture+'">'),$item.find("div.name").append(data.firstname),$item.find("div.name").append(" "),$item.find("div.name").append(data.lastname),$item.find("div.email").append(data.email),$item.find("div.body").append(data.print_text)}else if("headline"==data.type){tempString='<div id="id_holder" style="display:none;"></div>';tempString+='<div class="header">'+$E.translate("view_specialitem_headline")+'<div class="body"></div></div>',$item.html(tempString),$item.find("div.body").append(data.print_text)}else if("media"==data.type){tempString='<div id="id_holder" style="display:none;"></div>';tempString+='<div class="header"></div><div class="body"></div>',$item.html(tempString),$item.find("div.header").append($E.translate("view_specialitem_media")+($.trim(data.block_title).length?": "+data.block_title:"")),$item.find("div.body").append(data.contentmedia)}else if("badge"==data.type)if(void 0===data.badge)$item.html("loading");else{var badge=data.badge;tempString='<div id="id_holder" style="display:none;"></div>';tempString+='<div class="item_info" style="overflow: hidden;">',tempString+='<div class="header">'+$E.translate("view_specialitem_badge")+": "+badge.name+"</div>",tempString+='<div class="picture" style="float:right; position: relative; height: 100px; width: 100px;">',tempString+='<img style="max-width: 100%; max-height: 100%;" src="'+badge.imageUrl+'">',tempString+="</div>",tempString+='<div class="body">'+badge.description+"</div>",$item.html(tempString)}else if("cv_group"==data.type){var body_content="",attachments=[];switch(data.resume_itemtype){case"cover":addToHeader="",resumeItems&&resumeItems.cover&&(body_content=resumeItems.cover);break;case"edu":if(addToHeader=$E.translate("cofigureblock_cvinfo_education_history"),data.text&&resumeItems)(itemIds=data.text.split(",")).forEach((function(itemid,index){if(resumeItems.educations[itemid]){var description="";description+='<span class="edu_institution">'+(item_data=resumeItems.educations[itemid]).institution+":</span> ",description+='<span class="edu_qualname">'+item_data.qualname+"</span>",""==item_data.startdate&&""==item_data.enddate||(description+=" (",""!=item_data.startdate&&(description+='<span class="edu_startdate">'+item_data.startdate+"</span>"),""!=item_data.enddate&&(description+='<span class="edu_enddate"> - '+item_data.enddate+"</span>"),description+=")"),""!=item_data.qualdescription&&(description+='<span class="edu_qualdescription">'+item_data.qualdescription+"</span>"),body_content+=description,index<itemIds.length-1&&(body_content+="<br>"),attachments=item_data.attachments,"1"==data.resume_withfiles&&attachments&&attachments.length&&(body_content+='<ul class="resume_attachments '+data.resume_itemtype+'_attachments">',$.each(attachments,(function(k,file){body_content+='<li><a href="'+file.fileurl+'" target="_blank">'+file.filename+"</a></li>"})),body_content+="</ul>")}}));break;case"employ":if(addToHeader=$E.translate("cofigureblock_cvinfo_employment_history"),data.text&&resumeItems)(itemIds=data.text.split(",")).forEach((function(itemid,index){if(resumeItems.educations[itemid]){var description="";description+='<span class="employ_jobtitle">'+(item_data=resumeItems.employments[itemid]).jobtitle+":</span> ",description+='<span class="employ_employer">'+item_data.employer+"</span>",""==item_data.startdate&&""==item_data.enddate||(description+=" (",""!=item_data.startdate&&(description+='<span class="employ_startdate">'+item_data.startdate+"</span>"),""!=item_data.enddate&&(description+='<span class="employ_enddate"> - '+item_data.enddate+"</span>"),description+=")"),""!=item_data.positiondescription&&(description+='<span class="employ_positiondescription">'+item_data.positiondescription+"</span>"),body_content+=description,index<itemIds.length-1&&(body_content+="<br>"),attachments=item_data.attachments,"1"==data.resume_withfiles&&attachments&&attachments.length&&(body_content+='<ul class="resume_attachments '+data.resume_itemtype+'_attachments">',$.each(attachments,(function(k,file){body_content+='<li><a href="'+file.fileurl+'" target="_blank">'+file.filename+"</a></li>"})),body_content+="</ul>")}}));break;case"certif":if(addToHeader=$E.translate("cofigureblock_cvinfo_certif"),data.text&&resumeItems)(itemIds=data.text.split(",")).forEach((function(itemid,index){if(resumeItems.certifications[itemid]){var description="";description+='<span class="certif_title">'+(item_data=resumeItems.certifications[itemid]).title+"</span> ",""!=item_data.date&&(description+='<span class="certif_date">('+item_data.date+")</span>"),""!=item_data.description&&(description+='<span class="certif_description">'+item_data.description+"</span>"),body_content+=description,index<itemIds.length-1&&(body_content+="<br>"),attachments=item_data.attachments,"1"==data.resume_withfiles&&attachments&&attachments.length&&(body_content+='<ul class="resume_attachments '+data.resume_itemtype+'_attachments">',$.each(attachments,(function(k,file){body_content+='<li><a href="'+file.fileurl+'" target="_blank">'+file.filename+"</a></li>"})),body_content+="</ul>")}}));break;case"public":if(addToHeader=$E.translate("cofigureblock_cvinfo_public"),data.text&&resumeItems)(itemIds=data.text.split(",")).forEach((function(itemid,index){if(resumeItems.publications[itemid]){var description="";description+='<span class="public_title">'+(item_data=resumeItems.publications[itemid]).title,""!=item_data.contribution&&(description+=" ("+item_data.contribution+")"),description+="</span> ",""!=item_data.date&&(description+='<span class="public_date">('+item_data.date+")</span>"),""==item_data.contributiondetails&&""==item_data.url||(description+='<span class="public_description">',""!=item_data.contributiondetails&&(description+=item_data.contributiondetails),""!=item_data.url&&(description+='<br /><a href="'+item_data.url+'" class="public_url" target="_blank">'+item_data.url+"</a>"),description+="</span>"),body_content+=description,index<itemIds.length-1&&(body_content+="<br>"),attachments=item_data.attachments,"1"==data.resume_withfiles&&attachments&&attachments.length&&(body_content+='<ul class="resume_attachments '+data.resume_itemtype+'_attachments">',$.each(attachments,(function(k,file){body_content+='<li><a href="'+file.fileurl+'" target="_blank">'+file.filename+"</a></li>"})),body_content+="</ul>")}}));break;case"mbrship":if(addToHeader=$E.translate("cofigureblock_cvinfo_mbrship"),data.text&&resumeItems)(itemIds=data.text.split(",")).forEach((function(itemid,index){if(resumeItems.profmembershipments[itemid]){var description="";description+='<span class="mbrship_title">'+(item_data=resumeItems.profmembershipments[itemid]).title+"</span> ",""==item_data.startdate&&""==item_data.enddate||(description+=" (",""!=item_data.startdate&&(description+='<span class="mbrship_startdate">'+item_data.startdate+"</span>"),""!=item_data.enddate&&(description+='<span class="mbrship_enddate"> - '+item_data.enddate+"</span>"),description+=")"),""!=item_data.description&&(description+='<span class="mbrship_description">'+item_data.description+"</span>"),body_content+=description,index<itemIds.length-1&&(body_content+="<br>"),attachments=item_data.attachments,"1"==data.resume_withfiles&&attachments&&attachments.length&&(body_content+='<ul class="resume_attachments '+data.resume_itemtype+'_attachments">',$.each(attachments,(function(k,file){body_content+='<li><a href="'+file.fileurl+'" target="_blank">'+file.filename+"</a></li>"})),body_content+="</ul>")}}));break;case"goals":case"skills":var itemIds;if(addToHeader=$E.translate("cofigureblock_cvinfo_"+data.resume_itemtype),data.text&&resumeItems)(itemIds=data.text.split(",")).forEach((function(goalSkillType,index){var description="";resumeItems[goalSkillType]&&(description+="<strong>"+$E.translate("resume_"+goalSkillType)+":</strong><br>",description+='<span class="'+goalSkillType+'_text">'+resumeItems[goalSkillType]+"</span> "),description=description.replace(/(<br\s*\/?>)+$/i,""),description+=function(attachments){var attachmentsContent="";return attachments&&attachments.length&&(attachmentsContent+='<ul class="resume_attachments '+data.resume_itemtype+'_attachments">',$.each(attachments,(function(k,file){attachmentsContent+='<li><a href="'+file.fileurl+'" target="_blank">'+file.filename+"</a></li>"})),attachmentsContent+="</ul>"),attachmentsContent}(attachments=resumeItems[goalSkillType+"_attachments"]),body_content+=description,index<itemIds.length-1&&(body_content+="<br>")}));break;case"interests":addToHeader=$E.translate("cofigureblock_cvinfo_interests");var description="";""!=resumeItems.interests&&(description+='<span class="interests">'+resumeItems.interests+"</span> "),body_content=description}if(""!=body_content){tempString='<div id="id_holder" style="display:none;"></div>';tempString+='<div class="cv_group" style="overflow: hidden;">',tempString+='<div class="header">'+$E.translate("cvgroup")+": "+addToHeader+"</div>",tempString+='<div class="body">'+body_content+"</div>",tempString+="</div>",$item.html(tempString)}}else if("cv_information"==data.type){data.item=null;body_content="";var addToHeader="";attachments=[];switch(data.resume_itemtype){case"cover":resumeItems&&resumeItems.cover&&(body_content=resumeItems.cover);break;case"edu":if(addToHeader=$E.translate("cofigureblock_cvinfo_education_history"),data.itemid&&resumeItems&&resumeItems.educations[data.itemid]){item_data=resumeItems.educations[data.itemid],attachments=item_data.attachments;description="";description+='<span class="edu_institution">'+item_data.institution+":</span> ",description+='<span class="edu_qualname">'+item_data.qualname+"</span>",""==item_data.startdate&&""==item_data.enddate||(description+=" (",""!=item_data.startdate&&(description+='<span class="edu_startdate">'+item_data.startdate+"</span>"),""!=item_data.enddate&&(description+='<span class="edu_enddate"> - '+item_data.enddate+"</span>"),description+=")"),""!=item_data.qualdescription&&(description+='<span class="edu_qualdescription">'+item_data.qualdescription+"</span>"),body_content=description}break;case"employ":if(addToHeader=$E.translate("cofigureblock_cvinfo_employment_history"),data.itemid&&resumeItems&&resumeItems.employments[data.itemid]){item_data=resumeItems.employments[data.itemid],attachments=item_data.attachments;description="";description+='<span class="employ_jobtitle">'+item_data.jobtitle+":</span> ",description+='<span class="employ_employer">'+item_data.employer+"</span>",""==item_data.startdate&&""==item_data.enddate||(description+=" (",""!=item_data.startdate&&(description+='<span class="employ_startdate">'+item_data.startdate+"</span>"),""!=item_data.enddate&&(description+='<span class="employ_enddate"> - '+item_data.enddate+"</span>"),description+=")"),""!=item_data.positiondescription&&(description+='<span class="employ_positiondescription">'+item_data.positiondescription+"</span>"),body_content=description}break;case"certif":if(addToHeader=$E.translate("cofigureblock_cvinfo_certif"),data.itemid&&resumeItems&&resumeItems.certifications[data.itemid]){item_data=resumeItems.certifications[data.itemid],attachments=item_data.attachments;description="";description+='<span class="certif_title">'+item_data.title+"</span> ",""!=item_data.date&&(description+='<span class="certif_date">('+item_data.date+")</span>"),""!=item_data.description&&(description+='<span class="certif_description">'+item_data.description+"</span>"),body_content=description}break;case"public":if(addToHeader=$E.translate("cofigureblock_cvinfo_public"),data.itemid&&resumeItems&&resumeItems.publications[data.itemid]){item_data=resumeItems.publications[data.itemid],attachments=item_data.attachments;description="";description+='<span class="public_title">'+item_data.title,""!=item_data.contribution&&(description+=" ("+item_data.contribution+")"),description+="</span> ",""!=item_data.date&&(description+='<span class="public_date">('+item_data.date+")</span>"),""==item_data.contributiondetails&&""==item_data.url||(description+='<span class="public_description">',""!=item_data.contributiondetails&&(description+=item_data.contributiondetails),""!=item_data.url&&(description+='<br /><a href="'+item_data.url+'" class="public_url" target="_blank">'+item_data.url+"</a>"),description+="</span>"),body_content=description}break;case"mbrship":if(addToHeader=$E.translate("cofigureblock_cvinfo_mbrship"),data.itemid&&resumeItems&&resumeItems.profmembershipments[data.itemid]){item_data=resumeItems.profmembershipments[data.itemid],attachments=item_data.attachments;description="";description+='<span class="mbrship_title">'+item_data.title+"</span> ",""==item_data.startdate&&""==item_data.enddate||(description+=" (",""!=item_data.startdate&&(description+='<span class="mbrship_startdate">'+item_data.startdate+"</span>"),""!=item_data.enddate&&(description+='<span class="mbrship_enddate"> - '+item_data.enddate+"</span>"),description+=")"),""!=item_data.description&&(description+='<span class="mbrship_description">'+item_data.description+"</span>"),body_content=description}break;case"goalspersonal":case"goalsacademic":case"goalscareers":case"skillspersonal":case"skillsacademic":case"skillscareers":attachments=resumeItems[data.resume_itemtype+"_attachments"],addToHeader=$E.translate("resume_"+data.resume_itemtype);description="";resumeItems[""+data.resume_itemtype]&&(description+='<span class="'+data.resume_itemtype+'_text">'+resumeItems[""+data.resume_itemtype]+"</span> "),body_content=description;break;case"interests":addToHeader=$E.translate("cofigureblock_cvinfo_interests");description="";""!=resumeItems.interests&&(description+='<span class="interests">'+resumeItems.interests+"</span> "),body_content=description}"1"==data.resume_withfiles&&attachments&&attachments.length&&(body_content+='<ul class="resume_attachments '+data.resume_itemtype+'_attachments">',$.each(attachments,(function(k,file){body_content+='<li><a href="'+file.fileurl+'" target="_blank">'+file.filename+"</a></li>"})),body_content+="</ul>");tempString='<div id="id_holder" style="display:none;"></div>';tempString+='<div class="cv_info" style="overflow: hidden;">',tempString+='<div class="header">'+$E.translate("cvinformation")+": "+addToHeader+"</div>",tempString+='<div class="body">'+body_content+"</div>",tempString+="</div>",$item.html(tempString)}else{data.type="text";tempString='<div id="id_holder" style="display:none;"></div>';tempString+='<div class="header"></div>',tempString+='<div class="body"><p class="text" '+$E.translate("view_specialitem_text_defaulttext")+'"></p></div>',$item.html(tempString),$item.find("div.header").append($E.translate("view_specialitem_text")+($.trim(data.block_title).length?": "+data.block_title:"")),$item.find("div.body").append(data.print_text)}if($item.find(":input[default-text]").focus((function(){$(this).removeClass("default-text"),$(this).attr("default-text")==$(this).val()&&$(this).val("")})).blur((function(){$.trim($(this).val())||($(this).addClass("default-text"),$(this).val($(this).attr("default-text")))})).blur(),$item.find("div#id_holder").append(data.id),"new"==type){["item","badge","cv_information","cv_group"].indexOf(data.type)>-1||$('<a class="edit" title="Edit"><i class="fa-solid fa-pen-to-square" /><span>Edit</span></a>').prependTo($item).click(editItemClick)}else $item.append('<a class="unsaved" title="This block was not saved"><span>Unsaved</span></a>');return $('<a class="delete" title="'+$E.translate("delete")+'"><i class="fa-regular fa-trash-can" /><span>'+$E.translate("delete")+"</span></a>").prependTo($item).click(deleteItemClick),$item.find(":input").change((function(){$item.data("portfolio").text=$(this).val()})),updateBlockData(),1==data.unshared&&($item.find("div.item_info").addClass("unshared_block"),$item_header=$item.find("div.header").html(),$item.find("div.header").html($item_header+'<span class="unshared_message">Unshared</span>')),block_exaport_update_fontawesome_icons($item),$item}function deleteItemClick(){$(this).parents(".item").remove(),resetElementStates(),updateBlockData()}function saveBlockData(){var data=$("form#view_edit_form").serializeArray();data.push({name:"ajax",value:1}),console.log("views.js:1126"),console.log(data),showPreloadinator($("#view-preview"),"",!0),$.ajax({url:document.location.href,type:"POST",data:data,success:function(res){var data=JSON.parse(res);$("form :input[name=blocks]").val(data.blocks),exaportViewEdit.resetViewContent(),hidePreloadinator($("#view-preview"),"")}})}function editItemClick(){var item_id=$(this).parent().find("#id_holder").html();showPreloadinator(lastclicked=$(this).parent(),"",!1),$.ajax({url:M.cfg.wwwroot+"/blocks/exaport/blocks.json.php",type:"POST",data:{item_id:item_id,action:"edit",viewid:$("form :input[name=viewid]").val(),"text[itemid]":$("form :input[name=draft_itemid]").val(),sesskey:$("form :input[name=sesskey]").val()},success:function(res){var data=JSON.parse(res);showDialog(data.modalTitle,data.html)}})}var initContentEdit=function(){(exaportViewEdit={strip_tags:function(text){return(new DOMParser).parseFromString(text,"text/html").body.textContent||""},resetViewContent:function(){var blocks=$("form :input[name=blocks]").val();blocks&&(blocks=JSON.parse(blocks));var myresume=$("form :input[name=myresume]").val();myresume&&(myresume=JSON.parse(myresume)),blocks||(blocks=[{type:"headline"}]);var portfolioDesignBlocks=$(".portfolioDesignBlocks");portfolioDesignBlocks.empty(),$.each(blocks,(function(){generateItem("new",this).appendTo(this.positionx&&portfolioDesignBlocks[this.positionx-1]?portfolioDesignBlocks[this.positionx-1]:portfolioDesignBlocks[0])})),resetElementStates(),updateBlockData()},initAddItems:function(){$("#add-items-list .add-item").click((function(event){var $input=$(this).find("input");$(event.target).is(":input")||$input.prop("checked",!$input.prop("checked")),$input.prop("checked")?$(this).addClass("checked"):$(this).removeClass("checked")}))},addPersonalInfo:function(id){if(this.checkFields()){-1!=id&&(newItem=lastclicked);var data=new Object;data.type="personal_information",data.id=id,$("#block_title").length?data.block_title=this.strip_tags($("#block_title").val()):data.block_title="";var fncheckbox=$('.pieform input[name="fields[firstname]"]').first();void 0!==fncheckbox&&fncheckbox.is(":checked")&&(data.firstname=fncheckbox.val());var lncheckbox=$('.pieform input[name="fields[lastname]"]').first();if(lncheckbox.is(":checked")&&(data.lastname=lncheckbox.val()),data.picture=$("form input[name=picture]:checked").val(),data.email=$("form input[name=email]:checked").val(),data.text=$("#id_block_intro").val(),$(".mceEditor iframe").length){var iframe=$(".mceEditor iframe"),iframetextElement=$("#tinymce",iframe.contents());iframetextElement.length&&(data.text=iframetextElement.html())}newItem.data("portfolio",data),generateItem("update",$(newItem)),dialogue.hide(),newItem=null,saveBlockData()}},addHeadline:function(id){this.checkFields()&&(-1!=id&&(newItem=lastclicked),data={},data.text=$("#headline").val(),data.type="headline",data.id=id,newItem.data("portfolio",data),generateItem("update",$(newItem)),newItem=null,dialogue.hide(),saveBlockData())},addText:function(id){if(this.checkFields()){if(-1!=id&&(newItem=lastclicked),data={},data.type="text",data.id=id,data.block_title=this.strip_tags($("#block_title").val()),data.text=$("#id_block_text").val(),$(".mceEditor iframe").length){var iframe=$(".mceEditor iframe"),iframetextElement=$("#tinymce",iframe.contents());iframetextElement.length&&(data.text=iframetextElement.html())}newItem.data("portfolio",data),generateItem("update",$(newItem)),dialogue.hide(),newItem=null,saveBlockData()}},addItem:function(id){if(this.checkFields()){-1!=id&&(newItem=lastclicked);var i=0;$("#blockform input.add-item-checkbox:checked").each((function(){if((i+=1)>1){var clone=$(newItem).clone();newItem.after(clone),newItem=clone}data={},data.type="item",data.itemid=$(this).val(),newItem.data("portfolio",data),generateItem("update",$(newItem))})),dialogue.hide(),newItem=null,saveBlockData()}},addCvInfo:function(id){if(this.checkFields()){-1!=id&&(newItem=lastclicked);var i=0,resume_withfiles=0;$('#blockform [name="add_withfiles"]').is(":checked")&&(resume_withfiles=1);var category_grouping=0;if($('#blockform [name="category_grouping"]').is(":checked")&&(category_grouping=1),category_grouping){var groupedValues={};$("#blockform input.add-cvitem-checkbox").each((function(){if($(this).is(":checked")){var itemid=$(this).val(),cvtype=$(this).data("cvtype");["goalspersonal","goalsacademic","goalscareers"].indexOf(cvtype)>-1&&(itemid=cvtype,cvtype="goals"),["skillspersonal","skillsacademic","skillscareers"].indexOf(cvtype)>-1&&(itemid=cvtype,cvtype="skills"),groupedValues[cvtype]||(groupedValues[cvtype]=[]),groupedValues[cvtype].push(itemid)}})),Object.keys(groupedValues).map((function(groupType){if((i+=1)>1){var clone=$(newItem).clone();newItem.after(clone),newItem=clone}data={},data.type="cv_group",data.resume_itemtype=groupType,data.itemid=null,data.text=groupedValues[groupType].join(","),data.resume_withfiles=resume_withfiles,newItem.data("portfolio",data),generateItem("update",$(newItem))}))}else $("#blockform input.add-cvitem-checkbox:checked").each((function(){if((i+=1)>1){var clone=$(newItem).clone();newItem.after(clone),newItem=clone}data={},data.type="cv_information",data.itemid=$(this).val(),data.resume_withfiles=resume_withfiles,data.resume_itemtype=$(this).attr("data-cvtype"),["goalspersonal","goalsacademic","goalscareers","skillspersonal","skillsacademic","skillscareers"].indexOf(data.resume_itemtype)>-1&&(data.itemid=null),newItem.data("portfolio",data),generateItem("update",$(newItem))}));dialogue.hide(),newItem=null,saveBlockData()}},addMedia:function(id){this.checkFields()&&(-1!=id&&(newItem=lastclicked),data={},data.block_title=this.strip_tags($("#block_title").val()),data.type="media",data.contentmedia=$("#block_media").val(),data.width=$("#block_width").val(),data.height=$("#block_height").val(),data.create_as_note=$("input[name=create_as_note]:checked").length?1:0,data.id=id,newItem.data("portfolio",data),generateItem("update",$(newItem)),dialogue.hide(),newItem=null,saveBlockData())},addBadge:function(id){if(this.checkFields()){-1!=id&&(newItem=lastclicked);var i=0;$('#blockform input[name="add_badges[]"]:checked').each((function(){if((i+=1)>1){var clone=$(newItem).clone();newItem.after(clone),newItem=clone}data={},data.type="badge",data.itemid=$(this).val(),newItem.data("portfolio",data),generateItem("update",$(newItem))})),dialogue.hide(),newItem=null,saveBlockData()}},checkFields:function(){var ok=!0;return $("#blockform .not-empty-check").each((function(){var forInput=$(this).attr("for"),input=$("#blockform").find('input[name="'+forInput+'"]');if(0!=input.length){if(!input.val().length)return $(this).show(),input.focus(),ok=!1,!1;$(this).hide()}else $(this).hide()})),ok},filterItemsByTag:function(){$("#filterByTitle").val(""),$("div.add-item-category").hide(),$("div.add-item").show(),$("div.add-item-sub").show(),$("tr.sharedArtefacts").show();var selectedTag=$(".tagfilter").val();""!=selectedTag?$("div.add-item").each((function(){var elementTags=$(this).data("tags");void 0!==elementTags?-1==elementTags.indexOf(selectedTag)&&$(this).hide():$(this).hide()})):$("div.add-item-category, div.add-item-sub").show(),$("div.add-item-sub").each((function(){0==$(this).find("div.add-item:visible").length&&$(this).hide()})),$("div.add-item:visible").each((function(){var category_id=$(this).data("category");$('div.add-item-category[data-category="'+category_id+'"]').show()})),0==$('div.add-item[data-category="sharedFromUser"]:visible').length&&$("tr.sharedArtefacts").hide()},filterItemsByTitle:function(){$(".tagfilter").length&&($(".tagfilter")[0].selectedIndex=0);var text=$("#blockform #filterByTitle").val().toLowerCase();$("div.add-item-category").hide(),$("div.add-item").show(),$("div.add-item-sub").show(),$("tr.sharedArtefacts").show(),""!=text?$("div.add-item:visible").each((function(){$(this).text().toLowerCase().indexOf(text)>-1?$(this).show():$(this).hide()})):$("div.add-item-category, div.add-item-sub").show(),$("div.add-item-sub").each((function(){0==$(this).find("div.add-item:visible").length&&$(this).hide()})),$("div.add-item:visible").each((function(){var category_id=$(this).data("category");$('div.add-item-category[data-category="'+category_id+'"]').show()})),0==$('div.add-item[data-category="sharedFromUser"]:visible').length&&$("tr.sharedArtefacts").hide()},clearItemFilters:function(){$(".tagfilter").length&&($(".tagfilter")[0].selectedIndex=0),$("#blockform #filterByTitle").val(""),exaportViewEdit.filterItemsByTitle()},cancelAddEdit:function(){dialogue.hide(),updateBlockData()}}).resetViewContent(),$(".portfolioDesignBlocks").sortable({beforeStop:function(event,ui){newItem=ui.item},receive:function(e,ui){console.log("start to modal!"),-1==$(ui.item[0]).closest("ul").prop("className").search("portfolioDesignBlocks")&&($.ajax({url:M.cfg.wwwroot+"/blocks/exaport/blocks.json.php",type:"POST",data:{type_block:ui.item.attr("block-type"),action:"add",viewid:$("form :input[name=viewid]").val(),"text[itemid]":$("form :input[name=draft_itemid]").val(),sesskey:$("form :input[name=sesskey]").val()},success:function(res){var data=JSON.parse(res);showDialog(data.modalTitle,data.html),$("#temp_javascript").remove();var script=document.createElement("script");$(script).attr("id","temp_javascript"),script.textContent=data.script,document.body.appendChild(script),$("body").on("change keydown paste input","#filterByTitle",exaportViewEdit.filterItemsByTitle)}}),updateBlockData())},update:function(e,ui){updateBlockData()},handle:".header",placeholder:"block-placeholder",forcePlaceholderSize:!0,connectWith:[".portfolioDesignBlocks"]}),$(".portfolioOptions").sortable({connectWith:[".portfolioDesignBlocks"],placeholder:"block-placeholder",forcePlaceholderSize:!0,stop:function(e,ui){resetElements()}}),$(".portfolioElement").draggable({connectToSortable:".portfolioDesignBlocks",placeholder:".block-placeholder",forcePlaceholderSize:!0,helper:"clone",stop:function(e,ui){showPreloadinator($(ui.helper),"",!1)}}),$("body").on("click",'[data-toggle="gtn-help-modal"]',(function(e){e.preventDefault();var trigger=$(this),title=$(this).attr("data-title"),content=$(this).attr("data-content");helpDialogue?(helpDialogue.setTitle(title),helpDialogue.setBody(content),helpDialogue.show()):modalFactory.create({title:title,body:content,footer:""},trigger).done((function(modal){(helpDialogue=modal).setTitle(title),helpDialogue.setBody(content),helpDialogue.show()}))}))};function showPreloadinator(element,tohide,fixedposition){var id="preloader"+$.now(),preloadinatorTemplate='<div id="'+id+'" class="preloader '+(fixedposition?"preloader-fixed":"")+' js-preloader flex-center"><div class="dots"><div class="dot"></div><div class="dot"></div><div class="dot"></div></div></div>';""!=tohide&&element.find(tohide).hide(),element.append(preloadinatorTemplate),setTimeout("$('#"+id+"').remove();",15e3)}function hidePreloadinator(element,toshow){""!=toshow&&$(element).find(".blocktype").show(),$(element).find(".preloader").remove()}function showDialog(title,body){dialogue?(dialogue.setTitle(title),dialogue.setBody(body),dialogue.show()):modalFactory.create(defaultModalOptions).done((function(modal){(dialogue=modal).setTitle(title),dialogue.setBody(body),dialogue.show(),dialogue.getRoot().on(modalEvents.shown,(function(){hidePreloadinator(newItem,".blocktype"),hidePreloadinator(lastclicked,"")})),dialogue.getRoot().on(modalEvents.hidden,(function(){dialogue.setBody(""),newItem&&$(newItem).remove()}))}))}function update_sharing(){var share_text="",$form=$("#exaport-view-mod");$form.find(":input[name=externaccess]").is(":checked")?(share_text+=$E.translate("externalaccess")+" ",$("#externaccess-settings").show()):$("#externaccess-settings").hide(),$form.find(":input[name=internaccess]").is(":checked")?($("#internaccess-settings").show(),$("#internaccess-groups").hide(),share_text&&(share_text+=" "+$E.translate("viewand")+" "),share_text+=$E.translate("internalaccess")+": ",1==$form.find(":input[name=shareall]:checked").val()?(share_text+=$E.translate("internalaccessall"),$("#internaccess-users").hide(),$("#internaccess-groups").hide()):2==$form.find(":input[name=shareall]:checked").val()?(share_text+=$E.translate("internalaccessgroups"),$("#internaccess-users").hide(),$("#internaccess-groups").show(),ExabisEportfolio.load_grouplist("views_mod")):(share_text+=$E.translate("internalaccessusers"),$("#internaccess-groups").hide(),$("#internaccess-users").show(),ExabisEportfolio.load_userlist("views_mod"))):$("#internaccess-settings").hide(),$form.find(":input[name=sharedemails]").is(":checked")?(share_text&&(share_text+=" "+$E.translate("viewand")+" "),share_text+=$E.translate("emailaccess")+" ",$("#emailaccess-settings").show()):$("#emailaccess-settings").hide(),share_text||(share_text=$E.translate("view_sharing_noaccess")),$("#view-share-text").html(share_text)}return{initialise:function(){initContentEdit(),$(".view-sharing input[type=checkbox], .view-sharing input[type=radio]").click(update_sharing),update_sharing()}}}));

//# sourceMappingURL=views.min.js.map