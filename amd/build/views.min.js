var exaportViewEdit,newItem=null,lastclicked=null;define ("block_exaport/views",["jquery","block_exaport/jquery-json","jqueryui","block_exaport/touchpunch","core/modal_factory","core/modal_events"],function(a,b,c,d,e,f){var r,s,t={title:"test title",body:"",footer:""},u=function(){return{resetViewContent:function resetViewContent(){var b=a("form :input[name=blocks]").val();if(b){b=a.parseJSON(b)}var c=a("form :input[name=myresume]").val();if(c){c=a.parseJSON(c)}if(!b){b=[{type:"headline"}]}var d=a(".portfolioDesignBlocks");d.empty();a.each(b,function(){j("new",this).appendTo(this.positionx&&d[this.positionx-1]?d[this.positionx-1]:d[0])});g();h()},initAddItems:function initAddItems(){a("#add-items-list .add-item").click(function(b){var c=a(this).find("input");if(!a(b.target).is(":input")){c.prop("checked",!c.prop("checked"))}if(c.prop("checked")){a(this).addClass("checked")}else{a(this).removeClass("checked")}})},addPersonalInfo:function addPersonalInfo(b){if(!this.checkFields()){return}if(-1!=b){newItem=lastclicked}var c={type:"personal_information",id:b,block_title:a("#block_title").val()},d=a(".pieform input[name=\"fields[firstname]\"]").first();if(d!==void 0&&d.is(":checked")){c.firstname=d.val()}var e=a(".pieform input[name=\"fields[lastname]\"]").first();if(e.is(":checked")){c.lastname=e.val()}c.picture=a("form input[name=picture]:checked").val();c.email=a("form input[name=email]:checked").val();c.text=a("#id_block_intro").val();if(a(".mceEditor iframe").length){var f=a(".mceEditor iframe"),g=a("#tinymce",f.contents());if(g.length){c.text=g.html()}}newItem.data("portfolio",c);j("update",a(newItem));r.hide();newItem=null;l()},addHeadline:function addHeadline(b){if(!this.checkFields()){return}if(-1!=b){newItem=lastclicked}data={};data.text=a("#headline").val();data.type="headline";data.id=b;newItem.data("portfolio",data);j("update",a(newItem));newItem=null;r.hide();l()},addText:function addText(b){if(!this.checkFields()){return}if(-1!=b){newItem=lastclicked}data={};data.type="text";data.id=b;data.block_title=a("#block_title").val();data.text=a("#id_block_text").val();if(a(".mceEditor iframe").length){var c=a(".mceEditor iframe"),d=a("#tinymce",c.contents());if(d.length){data.text=d.html()}}newItem.data("portfolio",data);j("update",a(newItem));r.hide();newItem=null;l()},addItem:function addItem(b){if(!this.checkFields()){return}if(-1!=b){newItem=lastclicked}var c=0;a("#blockform input.add-item-checkbox:checked").each(function(){c=c+1;if(1<c){var b=a(newItem).clone();newItem.after(b);newItem=b}data={};data.type="item";data.itemid=a(this).val();newItem.data("portfolio",data);j("update",a(newItem))});r.hide();newItem=null;l()},addCvInfo:function addCvInfo(b){if(!this.checkFields()){return}if(-1!=b){newItem=lastclicked}var c=0;a("#blockform input.add-cvitem-checkbox:checked").each(function(){c=c+1;if(1<c){var b=a(newItem).clone();newItem.after(b);newItem=b}data={};data.type="cv_information";data.itemid=a(this).val();if(a("#blockform [name=\"add_withfiles\"]").is(":checked")){data.resume_withfiles=1}else{data.resume_withfiles=0}data.resume_itemtype=a(this).attr("data-cvtype");if(-1<["goalspersonal","goalsacademic","goalcareers","skillspersonal","skillsacademic","skillscareers"].indexOf(data.resume_itemtype)){data.itemid=null}newItem.data("portfolio",data);j("update",a(newItem))});r.hide();newItem=null;l()},addMedia:function addMedia(b){if(!this.checkFields()){return}if(-1!=b){newItem=lastclicked}data={};data.block_title=a("#block_title").val();data.type="media";data.contentmedia=a("#block_media").val();data.width=a("#block_width").val();data.height=a("#block_height").val();data.create_as_note=a("input[name=create_as_note]:checked").length?1:0;data.id=b;newItem.data("portfolio",data);j("update",a(newItem));r.hide();newItem=null;l()},addBadge:function addBadge(b){if(!this.checkFields()){return}if(-1!=b){newItem=lastclicked}var c=0;a("#blockform input[name=\"add_badges[]\"]:checked").each(function(){c=c+1;if(1<c){var b=a(newItem).clone();newItem.after(b);newItem=b}data={};data.type="badge";data.itemid=a(this).val();newItem.data("portfolio",data);j("update",a(newItem))});r.hide();newItem=null;l()},checkFields:function checkFields(){var b=!0;a("#blockform .not-empty-check").each(function(){var c=a(this).attr("for"),d=a("#blockform").find("input[name=\""+c+"\"]");if(0==d.length){a(this).hide();return}if(d.val().length){a(this).hide();return}a(this).show();d.focus();b=!1;return!1});return b},filterItemsByTag:function filterItemsByTag(){a("#filterByTitle").val("");a("div.add-item-category").hide();a("div.add-item").show();a("div.add-item-sub").show();a("tr.sharedArtefacts").show();var b=a(".tagfilter").val();if(""!=b){a("div.add-item").each(function(){var c=a(this).data("tags");if(c!==void 0){if(-1==c.indexOf(b)){a(this).hide()}}else{a(this).hide()}})}else{a("div.add-item-category, div.add-item-sub").show()}a("div.add-item-sub").each(function(){if(0==a(this).find("div.add-item:visible").length){a(this).hide()}});a("div.add-item:visible").each(function(){var b=a(this).data("category");a("div.add-item-category[data-category=\""+b+"\"]").show()});if(0==a("div.add-item[data-category=\"sharedFromUser\"]:visible").length){a("tr.sharedArtefacts").hide()}},filterItemsByTitle:function filterItemsByTitle(){if(a(".tagfilter").length){a(".tagfilter")[0].selectedIndex=0}var b=a("#blockform #filterByTitle").val().toLowerCase();a("div.add-item-category").hide();a("div.add-item").show();a("div.add-item-sub").show();a("tr.sharedArtefacts").show();if(""!=b){a("div.add-item:visible").each(function(){var c=a(this).text();if(-1<c.toLowerCase().indexOf(b)){a(this).show()}else{a(this).hide()}})}else{a("div.add-item-category, div.add-item-sub").show()}a("div.add-item-sub").each(function(){if(0==a(this).find("div.add-item:visible").length){a(this).hide()}});a("div.add-item:visible").each(function(){var b=a(this).data("category");a("div.add-item-category[data-category=\""+b+"\"]").show()});if(0==a("div.add-item[data-category=\"sharedFromUser\"]:visible").length){a("tr.sharedArtefacts").hide()}},clearItemFilters:function clearItemFilters(){if(a(".tagfilter").length){a(".tagfilter")[0].selectedIndex=0}a("#blockform #filterByTitle").val("");exaportViewEdit.filterItemsByTitle()},cancelAddEdit:function cancelAddEdit(){r.hide();h()}}};function g(){a(".portfolioOptions li").removeClass("selected");a(".portfolioDesignBlocks > li").each(function(){a(".portfolioOptions li[itemid="+a(this).data("portfolio").itemid+"]").addClass("selected")})}function h(){var b=[];a(".portfolioDesignBlocks").each(function(c){a(this).children("li:visible").not(".block-placeholder").each(function(d){b.push(a.extend(a(this).data("portfolio"),{positionx:c+1,positiony:d+1}))})});var c=a("form :input[name=blocks]");c.val(a.toJSON(b))}function j(b,c){var d;if("new"==b){d=a("<li></li>");d.data("portfolio",c)}else{d=a(c);c=d.data("portfolio");if(!c){c={};if(d.attr("itemid")){c.type="item";c.itemid=d.attr("itemid")}else{c.type=d.attr("block-type");if(d.attr("text")){c.text=d.attr("text")}if(d.attr("block_title")){c.block_title=d.attr("block_title")}if(d.attr("firstname")){c.firstname=d.attr("firstname")}if(d.attr("lastname")){c.lastname=d.attr("lastname")}if(d.attr("picture")){c.picture=d.attr("picture")}if(d.attr("email")){c.email=d.attr("email")}}d.data("portfolio",c)}}d.addClass("item");d.css("position","relative");if(c.itemid&&!c.item&&portfolioItems&&portfolioItems[c.itemid]){c.item=portfolioItems[c.itemid]}if("item"==c.type&&c.itemid&&c.item){var e=c.item,f=e.link;if(""!=f){f=$E.translate("link")+": "+f+"<br />"}var g="";if(1<e.filescount){var i=40;if(3<e.filescount){i=35}if(5<e.filescount){i=30}g+="<div class=\"pictureset\" style=\"float:right; position: relative; text-align: right; max-width: 150px;\">";for(var j=0;j<e.filescount;j++){if(j&&0==j%5){g+="<br />"}g+="<div class=\"picture\" style=\"float:right; height: "+i+"px; width: "+i+"px;\">";g+="<img style=\"max-width: 100%; max-height: 100%;\" src=\""+M.cfg.wwwroot+"/blocks/exaport/item_thumb.php?item_id="+e.id+"&imindex="+j+"\">";g+="</div>"}g+="</div>"}else{g+="<div class=\"picture\" style=\"float:right; position: relative; height: 100px; width: 100px;\">";g+="<img style=\"max-width: 100%; max-height: 100%;\" src=\""+M.cfg.wwwroot+"/blocks/exaport/item_thumb.php?item_id="+e.id+"\">";g+="</div>"}var l="";l+="<div id=\"id_holder\" style=\"display:none;\"></div> ";l+="<div class=\"item_info\" style=\"overflow: hidden;\">";l+="<div class=\"header\">"+$E.translate("viewitem")+": "+e.name+"</div>";l+=g;l+="<div class=\"body\">"+$E.translate("type")+": "+$E.translate(e.type)+"<br />";l+=$E.translate("category")+": "+e.category+"<br />"+f;l+=$E.translate("comments")+": "+e.comments+"<div class=\"exaport-item-intro\"></div>";if(e.competences){l+="<script type=\"text/javascript\" src=\"javascript/wz_tooltip.js\"></script><a onmouseover=\"Tip('"+e.competences+"')\" onmouseout=\"UnTip()\"><img src=\""+M.cfg.wwwroot+"/pix/t/grades.png\" class=\"iconsmall\" alt=\"competences\" /></a>"}l+="</div></div>";d.html(l);if(!e.competences){d.find(".exaport-item-intro").html(e.intro)}}else if("personal_information"==c.type){var l="<div id=\"id_holder\" style=\"display:none;\"></div>";l+="<div class=\"personal_info\" style=\"overflow: hidden;\">";l+="<div class=\"header\">"+$E.translate("personalinformation")+": </div>";l+="<div class=\"picture\" style=\"float:right; position: relative;\"></div>";l+="<div class=\"name\"></div>";l+="<div class=\"email\"></div>";l+="<div class=\"body\"></div>";l+="</div>";d.html(l);d.find("div.header").append(c.block_title);if(""!=c.picture&&null!=c.picture){d.find("div.picture").append("<img src=\""+c.picture+"\">")}d.find("div.name").append(c.firstname);d.find("div.name").append(" ");d.find("div.name").append(c.lastname);d.find("div.email").append(c.email);d.find("div.body").append(c.print_text)}else if("headline"==c.type){var l="<div id=\"id_holder\" style=\"display:none;\"></div>";l+="<div class=\"header\">"+$E.translate("view_specialitem_headline")+"<div class=\"body\"></div></div>";d.html(l);d.find("div.body").append(c.print_text)}else if("media"==c.type){var l="<div id=\"id_holder\" style=\"display:none;\"></div>";l+="<div class=\"header\"></div><div class=\"body\"></div>";d.html(l);d.find("div.header").append($E.translate("view_specialitem_media")+(a.trim(c.block_title).length?": "+c.block_title:""));d.find("div.body").append(c.contentmedia)}else if("badge"==c.type){if("undefined"==typeof c.badge){d.html("loading")}else{var n=c.badge,l="<div id=\"id_holder\" style=\"display:none;\"></div>";l+="<div class=\"item_info\" style=\"overflow: hidden;\">";l+="<div class=\"header\">"+$E.translate("view_specialitem_badge")+": "+n.name+"</div>";l+="<div class=\"picture\" style=\"float:right; position: relative; height: 100px; width: 100px;\">";l+="<img style=\"max-width: 100%; max-height: 100%;\" src=\""+n.imageUrl+"\">";l+="</div>";l+="<div class=\"body\">"+n.description+"</div>";d.html(l)}}else if("cv_information"==c.type){c.item=null;var o="",p="",q=[];switch(c.resume_itemtype){case"edu":p=$E.translate("cofigureblock_cvinfo_education_history");if(c.itemid&&resumeItems&&resumeItems.educations[c.itemid]){e=resumeItems.educations[c.itemid];q=e.attachments;var r="";r+="<span class=\"edu_institution\">"+e.institution+":</span> ";r+="<span class=\"edu_qualname\">"+e.qualname+"</span>";if(""!=e.startdate||""!=e.enddate){r+=" (";if(""!=e.startdate){r+="<span class=\"edu_startdate\">"+e.startdate+"</span>"}if(""!=e.enddate){r+="<span class=\"edu_enddate\"> - "+e.enddate+"</span>"}r+=")"}if(""!=e.qualdescription){r+="<span class=\"edu_qualdescription\">"+e.qualdescription+"</span>"}o=r}break;case"employ":p=$E.translate("cofigureblock_cvinfo_employment_history");if(c.itemid&&resumeItems&&resumeItems.employments[c.itemid]){e=resumeItems.employments[c.itemid];q=e.attachments;var r="";r+="<span class=\"employ_jobtitle\">"+e.jobtitle+":</span> ";r+="<span class=\"employ_employer\">"+e.employer+"</span>";if(""!=e.startdate||""!=e.enddate){r+=" (";if(""!=e.startdate){r+="<span class=\"employ_startdate\">"+e.startdate+"</span>"}if(""!=e.enddate){r+="<span class=\"employ_enddate\"> - "+e.enddate+"</span>"}r+=")"}if(""!=e.positiondescription){r+="<span class=\"employ_positiondescription\">"+e.positiondescription+"</span>"}o=r}break;case"certif":p=$E.translate("cofigureblock_cvinfo_certif");if(c.itemid&&resumeItems&&resumeItems.certifications[c.itemid]){e=resumeItems.certifications[c.itemid];q=e.attachments;var r="";r+="<span class=\"certif_title\">"+e.title+"</span> ";if(""!=e.date){r+="<span class=\"certif_date\">("+e.date+")</span>"}if(""!=e.description){r+="<span class=\"certif_description\">"+e.description+"</span>"}o=r}break;case"public":p=$E.translate("cofigureblock_cvinfo_public");if(c.itemid&&resumeItems&&resumeItems.publications[c.itemid]){e=resumeItems.publications[c.itemid];q=e.attachments;var r="";r+="<span class=\"public_title\">"+e.title;if(""!=e.contribution){r+=" ("+e.contribution+")"}r+="</span> ";if(""!=e.date){r+="<span class=\"public_date\">("+e.date+")</span>"}if(""!=e.contributiondetails||""!=e.url){r+="<span class=\"public_description\">";if(""!=e.contributiondetails){r+=e.contributiondetails}if(""!=e.url){r+="<br /><a href=\""+e.url+"\" class=\"public_url\" target=\"_blank\">"+e.url+"</a>"}r+="</span>"}o=r}break;case"mbrship":p=$E.translate("cofigureblock_cvinfo_mbrship");if(c.itemid&&resumeItems&&resumeItems.profmembershipments[c.itemid]){e=resumeItems.profmembershipments[c.itemid];q=e.attachments;var r="";r+="<span class=\"mbrship_title\">"+e.title+"</span> ";if(""!=e.startdate||""!=e.enddate){r+=" (";if(""!=e.startdate){r+="<span class=\"mbrship_startdate\">"+e.startdate+"</span>"}if(""!=e.enddate){r+="<span class=\"mbrship_enddate\"> - "+e.enddate+"</span>"}r+=")"}if(""!=e.description){r+="<span class=\"mbrship_description\">"+e.description+"</span>"}o=r}break;case"goalspersonal":case"goalsacademic":case"goalscareers":case"skillspersonal":case"skillsacademic":case"skillscareers":q=resumeItems[c.resume_itemtype+"_attachments"];console.log(resumeItems);console.log(c.resume_itemtype+"_attachments");p=$E.translate("resume_"+c.resume_itemtype);var r="";if(resumeItems[""+c.resume_itemtype]){r+="<span class=\""+c.resume_itemtype+"_text\">"+resumeItems[""+c.resume_itemtype]+"</span> "}o=r;break;case"interests":p=$E.translate("cofigureblock_cvinfo_interests");var r="";if(""!=resumeItems.interests){r+="<span class=\"interests\">"+resumeItems.interests+"</span> "}o=r;break;default:break;}if("1"==c.resume_withfiles&&q&&q.length){o+="<ul class=\"resume_attachments "+c.resume_itemtype+"_attachments\">";a.each(q,function(a,b){o+="<li><a href=\""+b.fileurl+"\" target=\"_blank\">"+b.filename+"</a></li>"});o+="</ul>"}var l="<div id=\"id_holder\" style=\"display:none;\"></div>";l+="<div class=\"cv_info\" style=\"overflow: hidden;\">";l+="<div class=\"header\">"+$E.translate("cvinformation")+": "+p+"</div>";l+="<div class=\"body\">"+o+"</div>";l+="</div>";d.html(l)}else{c.type="text";var l="<div id=\"id_holder\" style=\"display:none;\"></div>";l+="<div class=\"header\"></div>";l+="<div class=\"body\"><p class=\"text\" "+$E.translate("view_specialitem_text_defaulttext")+"\"></p></div>";d.html(l);d.find("div.header").append($E.translate("view_specialitem_text")+(a.trim(c.block_title).length?": "+c.block_title:""));d.find("div.body").append(c.print_text)}d.find(":input[default-text]").focus(function(){a(this).removeClass("default-text");if(a(this).attr("default-text")==a(this).val()){a(this).val("")}}).blur(function(){if(!a.trim(a(this).val())){a(this).addClass("default-text");a(this).val(a(this).attr("default-text"))}}).blur();d.find("div#id_holder").append(c.id);if("new"==b){if(!(-1<["item","badge","cv_information"].indexOf(c.type))){a("<a class=\"edit\" title=\"Edit\"><span>Edit</span></a>").prependTo(d).click(m)}}else{d.append("<a class=\"unsaved\" title=\"This block was not saved\"><span>Unsaved</span></a>")}a("<a class=\"delete\" title=\""+$E.translate("delete")+"\"><span>"+$E.translate("delete")+"</span></a>").prependTo(d).click(k);d.find(":input").change(function(){d.data("portfolio").text=a(this).val()});h();if(1==c.unshared){d.find("div.item_info").addClass("unshared_block");$item_header=d.find("div.header").html();d.find("div.header").html($item_header+"<span class=\"unshared_message\">Unshared</span>")}return d}function k(){a(this).parents(".item").remove();g();h()}function l(){var b=a("form#view_edit_form").serializeArray();b.push({name:"ajax",value:1});n(a("#view-preview"),"",!0);a.ajax({url:document.location.href,type:"POST",data:b,success:function success(b){var c=JSON.parse(b);a("form :input[name=blocks]").val(c.blocks);exaportViewEdit.resetViewContent();o(a("#view-preview"),"")}})}function m(){var b=a(this).parent().find("#id_holder").html();lastclicked=a(this).parent();n(lastclicked,"",!1);a.ajax({url:M.cfg.wwwroot+"/blocks/exaport/blocks.json.php",type:"POST",data:{item_id:b,action:"edit",viewid:a("form :input[name=viewid]").val(),"text[itemid]":a("form :input[name=draft_itemid]").val(),sesskey:a("form :input[name=sesskey]").val()},success:function success(a){var b=JSON.parse(a);p(b.modalTitle,b.html)}})}var v=function(){exaportViewEdit=u();exaportViewEdit.resetViewContent();a(".portfolioDesignBlocks").sortable({beforeStop:function beforeStop(a,b){newItem=b.item},receive:function receive(b,c){console.log("start to modal!");var d=a(c.item[0]).closest("ul").prop("className");if(-1==d.search("portfolioDesignBlocks")){a.ajax({url:M.cfg.wwwroot+"/blocks/exaport/blocks.json.php",type:"POST",data:{type_block:c.item.attr("block-type"),action:"add",viewid:a("form :input[name=viewid]").val(),"text[itemid]":a("form :input[name=draft_itemid]").val(),sesskey:a("form :input[name=sesskey]").val()},success:function success(b){var c=JSON.parse(b);p(c.modalTitle,c.html);a("#temp_javascript").remove();var d=document.createElement("script");a(d).attr("id","temp_javascript");d.textContent=c.script;document.body.appendChild(d);a("body").on("change keydown paste input","#filterByTitle",exaportViewEdit.filterItemsByTitle)}});h()}},update:function update(){h()},handle:".header",placeholder:"block-placeholder",forcePlaceholderSize:!0,connectWith:[".portfolioDesignBlocks"]});a(".portfolioOptions").sortable({connectWith:[".portfolioDesignBlocks"],placeholder:"block-placeholder",forcePlaceholderSize:!0,stop:function stop(){resetElements()}});a(".portfolioElement").draggable({connectToSortable:".portfolioDesignBlocks",placeholder:".block-placeholder",forcePlaceholderSize:!0,helper:"clone",stop:function stop(b,c){n(a(c.helper),"",!1)}});a("body").on("click","[data-toggle=\"gtn-help-modal\"]",function(b){b.preventDefault();var c=a(this),d=a(this).attr("data-title"),f=a(this).attr("data-content");if(s){s.setTitle(d);s.setBody(f);s.show()}else{e.create({title:d,body:f,footer:""},c).done(function(a){s=a;s.setTitle(d);s.setBody(f);s.show()})}})};function n(b,c,d){var e="preloader"+a.now(),f="<div id=\""+e+"\" class=\"preloader "+(d?"preloader-fixed":"")+" js-preloader flex-center\"><div class=\"dots\"><div class=\"dot\"></div><div class=\"dot\"></div><div class=\"dot\"></div></div></div>";if(""!=c){b.find(c).hide()}b.append(f);setTimeout("$('#"+e+"').remove();",15e3)}function o(b,c){if(""!=c){a(b).find(".blocktype").show()}a(b).find(".preloader").remove()}function p(b,c){if(r){r.setTitle(b);r.setBody(c);r.show()}else{e.create(t).done(function(d){r=d;r.setTitle(b);r.setBody(c);r.show();r.getRoot().on(f.shown,function(){o(newItem,".blocktype");o(lastclicked,"");console.log("modal is shown")});r.getRoot().on(f.hidden,function(){r.setBody("");if(newItem){a(newItem).remove()}})})}}function q(){var b="",c=a("#exaport-view-mod");if(c.find(":input[name=externaccess]").is(":checked")){b+=$E.translate("externalaccess")+" ";a("#externaccess-settings").show()}else{a("#externaccess-settings").hide()}if(c.find(":input[name=internaccess]").is(":checked")){a("#internaccess-settings").show();a("#internaccess-groups").hide();if(b){b+=" "+$E.translate("viewand")+" "}b+=$E.translate("internalaccess")+": ";if(1==c.find(":input[name=shareall]:checked").val()){b+=$E.translate("internalaccessall");a("#internaccess-users").hide();a("#internaccess-groups").hide()}else if(2==c.find(":input[name=shareall]:checked").val()){b+=$E.translate("internalaccessgroups");a("#internaccess-users").hide();a("#internaccess-groups").show();ExabisEportfolio.load_grouplist("views_mod")}else{b+=$E.translate("internalaccessusers");a("#internaccess-groups").hide();a("#internaccess-users").show();ExabisEportfolio.load_userlist("views_mod")}}else{a("#internaccess-settings").hide()}if(c.find(":input[name=sharedemails]").is(":checked")){if(b){b+=" "+$E.translate("viewand")+" "}b+=$E.translate("emailaccess")+" ";a("#emailaccess-settings").show()}else{a("#emailaccess-settings").hide()}if(!b){b=$E.translate("view_sharing_noaccess")}a("#view-share-text").html(b)}return{initialise:function initialise(){v();a(".view-sharing input[type=checkbox], .view-sharing input[type=radio]").click(q);q()}}});
//# sourceMappingURL=views.min.js.map
