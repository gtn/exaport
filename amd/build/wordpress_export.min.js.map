{"version":3,"file":"wordpress_export.min.js","sources":["../src/wordpress_export.js"],"sourcesContent":["/* eslint-disable jsdoc/require-jsdoc,no-console,max-len */\nimport $ from 'jquery';\n// import Notification from 'core/notification';\nimport {add as addToast} from 'core/toast';\nimport Config from 'core/config';\n\nfunction buttonLoading(button, isLoading) {\n  // disable the button to prevent double click\n  button.prop('disabled', isLoading);\n  // for a-tags (disable the link with bootstrap .disabled-css-class)\n  button.toggleClass('disabled', isLoading);\n\n  var buttonIcon = button.find('.exaport-icon');\n  buttonIcon.toggleClass('fa-spin', isLoading);\n}\n\nexport function init() {\n\n  // Regular login button: silent creating of the wordpress account\n  $(document).on('click', '.exaport-wp-login, .exaport-wp-loginUpdate', function (e) {\n    e.preventDefault();\n    $('.exaport-wp-error').remove();\n    var theButton = $(this);\n    var action = 'login';\n    var successMessage = 'Logged in';\n    if (theButton.hasClass('exaport-wp-loginUpdate')) {\n      action = 'loginUpdate';\n      successMessage = 'Updated';\n    }\n\n    buttonLoading(theButton, true);\n\n    wpRequest(action, [], function (response) {\n      buttonLoading(theButton, false);\n\n      response = JSON.parse(response).response;\n      if (response.success) {\n        // get the form with WP functionality\n        wpRequest('wpForm', [], function (response) {\n          theButton.closest('form').html(response);\n        });\n        // showExaportToaster(successMessage);\n        addToast(successMessage, {\n          type: 'success',       // 'success' | 'info' | 'warning' | 'danger'\n          autohide: true,        // disappears after a few seconds\n        });\n      }\n      if (response.error) {\n        // showExaportToaster(response.message, 'error');\n        addToast(response.message, {\n          type: 'danger',       // 'success' | 'info' | 'warning' | 'danger'\n          autohide: false,        // disappears after a few seconds\n          closeButton: true,\n        });\n      }\n\n    }, function () {\n      buttonLoading(theButton, false);\n\n      addToast('Error: 1745225660311', {\n        type: 'danger',       // 'success' | 'info' | 'warning' | 'danger'\n        autohide: false,        // disappears after a few seconds\n        closeButton: true,\n      });\n      // showExaportToaster('Error: 1745225660311', 'error');\n    });\n  });\n\n  // send the view into WP\n  $(document).on('click', '.exaport-wp-viewExport, .exaport-wp-viewUpdate, .exaport-wp-viewRemove', function (e) {\n    e.preventDefault();\n    $('.exaport-wp-error').remove();\n    var theButton = $(this);\n    var viewId = theButton.attr('data-viewId');\n    var data = {\n      viewId: viewId\n    };\n    var action = 'viewExport';\n    var successMessage = 'Exported';\n    if (theButton.hasClass('exaport-wp-viewUpdate')) {\n      action = 'viewUpdate';\n      var successMessage = 'Updated';\n    } else if (theButton.hasClass('exaport-wp-viewRemove')) {\n      action = 'viewRemove';\n      var successMessage = 'Removed';\n    }\n\n    buttonLoading(theButton, true);\n\n    wpRequest(action, data, function (response) {\n      response = JSON.parse(response).response;\n      if (response && response.success) {\n        if (action == 'viewRemove') {\n          // hide \"view\" button\n          // add/update 'view' button\n          $('.exaport-wp-viewPreview[data-viewId=' + viewId + ']').addClass('d-none').attr('href', '#');\n          // update the \"update\" button to \"export\"\n          $('.exaport-wp-viewExport[data-viewId=' + viewId + ']').removeClass('d-none');\n          $('.exaport-wp-viewUpdate[data-viewId=' + viewId + ']').addClass('d-none');\n          // remove \"remove\" button\n          $('.exaport-wp-viewRemove[data-viewId=' + viewId + ']').addClass('d-none');\n          // update icons - hide them at all\n          var iconWrapper = $('.wp-exported-icons-wrapper[data-viewId=' + viewId + ']');\n          iconWrapper.find('.exaport-icon').addClass('d-none');\n          // clear the date\n          $('.wp-exported-wptimemodified-wrapper[data-viewId=' + viewId + ']').text('');\n        } else {\n          // add/update 'view' button\n          var viewButton = $('.exaport-wp-viewPreview[data-viewId=' + viewId + ']');\n          viewButton.removeClass('d-none');\n          viewButton.attr('href', response.view.url);\n          // update the \"export\" button to \"update\"\n          $('.exaport-wp-viewExport[data-viewId=' + viewId + ']').addClass('d-none');\n          $('.exaport-wp-viewUpdate[data-viewId=' + viewId + ']').removeClass('d-none');\n          // show \"remove\" button\n          $('.exaport-wp-viewRemove[data-viewId=' + viewId + ']').removeClass('d-none');\n          // update icons\n          var iconWrapper = $('.wp-exported-icons-wrapper[data-viewId=' + viewId + ']');\n          iconWrapper.find('.exaport-icon').addClass('d-none');\n          iconWrapper.find('.exaport-icon.wp-exported').removeClass('d-none');\n          // change the date\n          $('.wp-exported-wptimemodified-wrapper[data-viewId=' + viewId + ']').text(response.view.timemodified);\n        }\n        // toaster\n        // showExaportToaster(successMessage);\n        addToast(successMessage, {\n          type: 'success',       // 'success' | 'info' | 'warning' | 'danger'\n          autohide: true,        // disappears after a few seconds\n        });\n      }\n      if (response && response.error) {\n        // toaster\n        // showExaportToaster(response.message, 'error');\n        addToast(response.message, {\n          type: 'danger',       // 'success' | 'info' | 'warning' | 'danger'\n          autohide: false,        // disappears after a few seconds\n          closeButton: true,\n        });\n        // theButton.after('<div class=\"alert alert-danger alert-sm .exaport-wp-error\">' + response.message + '</div>');\n      }\n      if (!response) {\n        addToast('Request error!', {\n          type: 'danger',       // 'success' | 'info' | 'warning' | 'danger'\n          autohide: false,        // disappears after a few seconds\n          closeButton: true,\n        });\n        // showExaportToaster('Request error!', 'error');\n      }\n\n      // stop rotation\n      buttonLoading(theButton, false);\n    }, function () {\n      // stop rotation\n      buttonLoading(theButton, false);\n\n      // toaster\n      addToast('Request error!', {\n        type: 'danger',       // 'success' | 'info' | 'warning' | 'danger'\n        autohide: false,        // disappears after a few seconds\n        closeButton: true,\n      });\n      // showExaportToaster('Request error!', 'error');\n    });\n  });\n\n\n  // Send the CV into WP\n  $(document).on('click', '.exaport-wp-cvExport, .exaport-wp-cvUpdate, .exaport-wp-cvRemove', function (e) {\n    e.preventDefault();\n    $('.exaport-wp-error').remove();\n    var data = {};\n    var theButton = $(this);\n    var action = 'cvExport';\n    var successMessage = 'Exported';\n    if (theButton.hasClass('exaport-wp-cvUpdate')) {\n      action = 'cvUpdate';\n      var successMessage = 'Updated';\n    } else if (theButton.hasClass('exaport-wp-cvRemove')) {\n      action = 'cvRemove';\n      var successMessage = 'Removed';\n    }\n    // rotate the icon\n    buttonLoading(theButton, true);\n\n    wpRequest(action, data, function (response) {\n      response = JSON.parse(response).response;\n      if (response && response.success) {\n        if (action == 'cvRemove') {\n          // hide Info block\n          $('.exaport-wp-cv-info').addClass('d-none');\n          // show \"export\" button\n          $('.exaport-wp-cvExport').removeClass('d-none');\n        } else if (action == 'cvExport') {\n          // hide export button\n          $('.exaport-wp-cvExport').addClass('d-none');\n          // show info block\n          $('.exaport-wp-cv-info').removeClass('d-none');\n          // update the data\n          $('.exaport-wp-cv-info .date').text(response.cv.timemodified);\n          $('.exaport-wp-cv-info .exaport-wp-cvView').attr('href', response.cv.url);\n        } else {\n          // update the data\n          $('.exaport-wp-cv-info .date').text(response.cv.timemodified);\n          $('.exaport-wp-cv-info .exaport-wp-cvView').attr('href', response.cv.url);\n        }\n        // toaster\n        addToast(successMessage, {\n          type: 'success',       // 'success' | 'info' | 'warning' | 'danger'\n          autohide: true,        // disappears after a few seconds\n        });\n        // showExaportToaster(successMessage);\n      }\n      if (response && response.error) {\n        // toaster\n        addToast(response.message, {\n          type: 'danger',       // 'success' | 'info' | 'warning' | 'danger'\n          autohide: false,        // disappears after a few seconds\n          closeButton: true,\n        });\n        // showExaportToaster(response.message, 'error');\n      }\n      if (!response) {\n        addToast('Request error!', {\n          type: 'danger',       // 'success' | 'info' | 'warning' | 'danger'\n          autohide: false,        // disappears after a few seconds\n          closeButton: true,\n        });\n        // showExaportToaster('Request error!', 'error');\n      }\n\n      // stop rotation\n      buttonLoading(theButton, false);\n    }, function () {\n      // stop rotation\n      buttonLoading(theButton, false);\n      // toaster\n      addToast('Request error (code: 1745230772232)!', {\n        type: 'danger',       // 'success' | 'info' | 'warning' | 'danger'\n        autohide: false,        // disappears after a few seconds\n        closeButton: true,\n      });\n      // showExaportToaster('Request error (code: 1745230772232)!', 'error');\n    });\n  });\n}\n\n\nfunction wpRequest(action, parameters, successFunction, failureFunction) {\n\n  var ajaxUrl = $('.exaport-wp-form').attr('data-ajaxUrl');\n\n  $.ajax({\n    url: ajaxUrl,\n    type: 'POST',\n    data: {\n      wp_action: action,\n      parameters: parameters,\n      sesskey: Config.sesskey,\n    },\n    success: function (res) {\n      successFunction(res);\n    },\n    failure: function (res) {\n      failureFunction(res);\n    }\n  });\n\n}\n"],"names":["buttonLoading","button","isLoading","prop","toggleClass","find","wpRequest","action","parameters","successFunction","failureFunction","ajaxUrl","attr","ajax","url","type","data","wp_action","sesskey","Config","success","res","failure","document","on","e","preventDefault","remove","theButton","this","successMessage","hasClass","response","JSON","parse","closest","html","autohide","error","message","closeButton","viewId","addClass","removeClass","iconWrapper","text","viewButton","view","timemodified","cv"],"mappings":"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"}