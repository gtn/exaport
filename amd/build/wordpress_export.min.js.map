{"version":3,"file":"wordpress_export.min.js","sources":["../src/wordpress_export.js"],"sourcesContent":["/* eslint-disable jsdoc/require-jsdoc,no-console,max-len */\r\nimport $ from 'jquery';\r\n// import Notification from 'core/notification';\r\nimport {add as addToast} from 'core/toast';\r\nimport Config from 'core/config';\r\n\r\nfunction buttonLoading(button, isLoading) {\r\n  // disable the button to prevent double click\r\n  button.prop('disabled', isLoading);\r\n  // for a-tags (disable the link with bootstrap .disabled-css-class)\r\n  button.toggleClass('disabled', isLoading);\r\n\r\n  var buttonIcon = button.find('.exaport-icon');\r\n  buttonIcon.toggleClass('fa-spin', isLoading);\r\n}\r\n\r\nexport function init() {\r\n  // Regular login button: silent creating of the wordpress account\r\n  $(document).on('click', '.exaport-wp-login, .exaport-wp-loginUpdate', function (e) {\r\n    e.preventDefault();\r\n    $('.exaport-wp-error').remove();\r\n    var theButton = $(this);\r\n    var action = 'login';\r\n    var successMessage = 'Logged in';\r\n    if (theButton.hasClass('exaport-wp-loginUpdate')) {\r\n      action = 'loginUpdate';\r\n      successMessage = 'Updated';\r\n    }\r\n\r\n    buttonLoading(theButton, true);\r\n\r\n    wpRequest(action, [], function (response) {\r\n      buttonLoading(theButton, false);\r\n\r\n      response = JSON.parse(response).response;\r\n      if (response.success) {\r\n        // get the form with WP functionality\r\n        wpRequest('wpForm', [], function (response) {\r\n          theButton.closest('form').html(response);\r\n        });\r\n        // showExaportToaster(successMessage);\r\n        addToast(successMessage, {\r\n          type: 'success',       // 'success' | 'info' | 'warning' | 'danger'\r\n          autohide: true,        // disappears after a few seconds\r\n        });\r\n      }\r\n      if (response.error) {\r\n        // showExaportToaster(response.message, 'error');\r\n        addToast(response.message, {\r\n          type: 'danger',       // 'success' | 'info' | 'warning' | 'danger'\r\n          autohide: false,        // disappears after a few seconds\r\n          closeButton: true,\r\n        });\r\n      }\r\n\r\n    }, function () {\r\n      buttonLoading(theButton, false);\r\n\r\n      addToast('Error: 1745225660311', {\r\n        type: 'danger',       // 'success' | 'info' | 'warning' | 'danger'\r\n        autohide: false,        // disappears after a few seconds\r\n        closeButton: true,\r\n      });\r\n      // showExaportToaster('Error: 1745225660311', 'error');\r\n    });\r\n  });\r\n\r\n  // send the view into WP\r\n  $(document).on('click', '.exaport-wp-viewExport, .exaport-wp-viewUpdate, .exaport-wp-viewRemove', function (e) {\r\n    e.preventDefault();\r\n    $('.exaport-wp-error').remove();\r\n    var theButton = $(this);\r\n    var viewId = theButton.attr('data-viewId');\r\n    var data = {\r\n      viewId: viewId\r\n    };\r\n    var action = 'viewExport';\r\n    var successMessage = 'Exported';\r\n    if (theButton.hasClass('exaport-wp-viewUpdate')) {\r\n      action = 'viewUpdate';\r\n      var successMessage = 'Updated';\r\n    } else if (theButton.hasClass('exaport-wp-viewRemove')) {\r\n      action = 'viewRemove';\r\n      var successMessage = 'Removed';\r\n    }\r\n\r\n    buttonLoading(theButton, true);\r\n\r\n    wpRequest(action, data, function (response) {\r\n      response = JSON.parse(response).response;\r\n      if (response && response.success) {\r\n        if (action == 'viewRemove') {\r\n          // hide \"view\" button\r\n          // add/update 'view' button\r\n          $('.exaport-wp-viewPreview[data-viewId=' + viewId + ']').addClass('d-none').attr('href', '#');\r\n          // update the \"update\" button to \"export\"\r\n          $('.exaport-wp-viewExport[data-viewId=' + viewId + ']').removeClass('d-none');\r\n          $('.exaport-wp-viewUpdate[data-viewId=' + viewId + ']').addClass('d-none');\r\n          // remove \"remove\" button\r\n          $('.exaport-wp-viewRemove[data-viewId=' + viewId + ']').addClass('d-none');\r\n          // update icons - hide them at all\r\n          var iconWrapper = $('.wp-exported-icons-wrapper[data-viewId=' + viewId + ']');\r\n          iconWrapper.find('.exaport-icon').addClass('d-none');\r\n          // clear the date\r\n          $('.wp-exported-wptimemodified-wrapper[data-viewId=' + viewId + ']').text('');\r\n        } else {\r\n          // add/update 'view' button\r\n          var viewButton = $('.exaport-wp-viewPreview[data-viewId=' + viewId + ']');\r\n          viewButton.removeClass('d-none');\r\n          var href = response.view.shortUrl ? response.view.shortUrl : response.view.url;\r\n          viewButton.attr('href', href);\r\n          // update the \"export\" button to \"update\"\r\n          $('.exaport-wp-viewExport[data-viewId=' + viewId + ']').addClass('d-none');\r\n          $('.exaport-wp-viewUpdate[data-viewId=' + viewId + ']').removeClass('d-none');\r\n          // show \"remove\" button\r\n          $('.exaport-wp-viewRemove[data-viewId=' + viewId + ']').removeClass('d-none');\r\n          // update icons\r\n          var iconWrapper = $('.wp-exported-icons-wrapper[data-viewId=' + viewId + ']');\r\n          iconWrapper.find('.exaport-icon').addClass('d-none');\r\n          iconWrapper.find('.exaport-icon.wp-exported').removeClass('d-none');\r\n          // change the date\r\n          $('.wp-exported-wptimemodified-wrapper[data-viewId=' + viewId + ']').text(response.view.timemodified);\r\n        }\r\n        // toaster\r\n        // showExaportToaster(successMessage);\r\n        addToast(successMessage, {\r\n          type: 'success',       // 'success' | 'info' | 'warning' | 'danger'\r\n          autohide: true,        // disappears after a few seconds\r\n        });\r\n      }\r\n      if (response && response.error) {\r\n        // toaster\r\n        // showExaportToaster(response.message, 'error');\r\n        addToast(response.message, {\r\n          type: 'danger',       // 'success' | 'info' | 'warning' | 'danger'\r\n          autohide: false,        // disappears after a few seconds\r\n          closeButton: true,\r\n        });\r\n        // theButton.after('<div class=\"alert alert-danger alert-sm .exaport-wp-error\">' + response.message + '</div>');\r\n      }\r\n      if (!response) {\r\n        addToast('Request error!', {\r\n          type: 'danger',       // 'success' | 'info' | 'warning' | 'danger'\r\n          autohide: false,        // disappears after a few seconds\r\n          closeButton: true,\r\n        });\r\n        // showExaportToaster('Request error!', 'error');\r\n      }\r\n\r\n      // stop rotation\r\n      buttonLoading(theButton, false);\r\n    }, function () {\r\n      // stop rotation\r\n      buttonLoading(theButton, false);\r\n\r\n      // toaster\r\n      addToast('Request error!', {\r\n        type: 'danger',       // 'success' | 'info' | 'warning' | 'danger'\r\n        autohide: false,        // disappears after a few seconds\r\n        closeButton: true,\r\n      });\r\n      // showExaportToaster('Request error!', 'error');\r\n    });\r\n  });\r\n\r\n\r\n  // Send the CV into WP\r\n  $(document).on('click', '.exaport-wp-cvExport, .exaport-wp-cvUpdate, .exaport-wp-cvRemove', function (e) {\r\n    e.preventDefault();\r\n    $('.exaport-wp-error').remove();\r\n    var data = {};\r\n    var theButton = $(this);\r\n    var action = 'cvExport';\r\n    var successMessage = 'Exported';\r\n    if (theButton.hasClass('exaport-wp-cvUpdate')) {\r\n      action = 'cvUpdate';\r\n      var successMessage = 'Updated';\r\n    } else if (theButton.hasClass('exaport-wp-cvRemove')) {\r\n      action = 'cvRemove';\r\n      var successMessage = 'Removed';\r\n    }\r\n    // rotate the icon\r\n    buttonLoading(theButton, true);\r\n\r\n    wpRequest(action, data, function (response) {\r\n      response = JSON.parse(response).response;\r\n      if (response && response.success) {\r\n        if (action == 'cvRemove') {\r\n          // hide Info block\r\n          $('.exaport-wp-cv-info').addClass('d-none');\r\n          // show \"export\" button\r\n          $('.exaport-wp-cvExport').removeClass('d-none');\r\n        } else if (action == 'cvExport') {\r\n          // hide export button\r\n          $('.exaport-wp-cvExport').addClass('d-none');\r\n          // show info block\r\n          $('.exaport-wp-cv-info').removeClass('d-none');\r\n          // update the data\r\n          $('.exaport-wp-cv-info .date').text(response.cv.timemodified);\r\n          var href = response.cv.shortUrl ? response.cv.shortUrl : response.cv.url;\r\n          $('.exaport-wp-cv-info .exaport-wp-cvView').attr('href', href);\r\n        } else {\r\n          // update the data\r\n          $('.exaport-wp-cv-info .date').text(response.cv.timemodified);\r\n          var href = response.cv.shortUrl ? response.cv.shortUrl : response.cv.url;\r\n          $('.exaport-wp-cv-info .exaport-wp-cvView').attr('href', href);\r\n        }\r\n        // toaster\r\n        addToast(successMessage, {\r\n          type: 'success',       // 'success' | 'info' | 'warning' | 'danger'\r\n          autohide: true,        // disappears after a few seconds\r\n        });\r\n        // showExaportToaster(successMessage);\r\n      }\r\n      if (response && response.error) {\r\n        // toaster\r\n        addToast(response.message, {\r\n          type: 'danger',       // 'success' | 'info' | 'warning' | 'danger'\r\n          autohide: false,        // disappears after a few seconds\r\n          closeButton: true,\r\n        });\r\n        // showExaportToaster(response.message, 'error');\r\n      }\r\n      if (!response) {\r\n        addToast('Request error!', {\r\n          type: 'danger',       // 'success' | 'info' | 'warning' | 'danger'\r\n          autohide: false,        // disappears after a few seconds\r\n          closeButton: true,\r\n        });\r\n        // showExaportToaster('Request error!', 'error');\r\n      }\r\n\r\n      // stop rotation\r\n      buttonLoading(theButton, false);\r\n    }, function () {\r\n      // stop rotation\r\n      buttonLoading(theButton, false);\r\n      // toaster\r\n      addToast('Request error (code: 1745230772232)!', {\r\n        type: 'danger',       // 'success' | 'info' | 'warning' | 'danger'\r\n        autohide: false,        // disappears after a few seconds\r\n        closeButton: true,\r\n      });\r\n      // showExaportToaster('Request error (code: 1745230772232)!', 'error');\r\n    });\r\n  });\r\n}\r\n\r\n\r\nfunction wpRequest(action, parameters, successFunction, failureFunction) {\r\n\r\n  var ajaxUrl = $('.exaport-wp-form').attr('data-ajaxUrl');\r\n\r\n  $.ajax({\r\n    url: ajaxUrl,\r\n    type: 'POST',\r\n    data: {\r\n      wp_action: action,\r\n      parameters: parameters,\r\n      sesskey: Config.sesskey,\r\n    },\r\n    success: function (res) {\r\n      successFunction(res);\r\n    },\r\n    failure: function (res) {\r\n      failureFunction(res);\r\n    }\r\n  });\r\n\r\n}\r\n"],"names":["buttonLoading","button","isLoading","prop","toggleClass","find","wpRequest","action","parameters","successFunction","failureFunction","ajaxUrl","attr","ajax","url","type","data","wp_action","sesskey","Config","success","res","failure","document","on","e","preventDefault","remove","theButton","this","successMessage","hasClass","response","JSON","parse","closest","html","autohide","error","message","closeButton","viewId","addClass","removeClass","iconWrapper","text","viewButton","href","view","shortUrl","timemodified","cv"],"mappings":"8NAMSA,cAAcC,OAAQC,WAE7BD,OAAOE,KAAK,WAAYD,WAExBD,OAAOG,YAAY,WAAYF,WAEdD,OAAOI,KAAK,iBAClBD,YAAY,UAAWF,oBA4O3BI,UAAUC,OAAQC,WAAYC,gBAAiBC,qBAElDC,SAAU,mBAAE,oBAAoBC,KAAK,gCAEvCC,KAAK,CACLC,IAAKH,QACLI,KAAM,OACNC,KAAM,CACJC,UAAWV,OACXC,WAAYA,WACZU,QAASC,gBAAOD,SAElBE,QAAS,SAAUC,KACjBZ,gBAAgBY,MAElBC,QAAS,SAAUD,KACjBX,gBAAgBW,6GAvPlBE,UAAUC,GAAG,QAAS,8CAA8C,SAAUC,GAC9EA,EAAEC,qCACA,qBAAqBC,aACnBC,WAAY,mBAAEC,MACdtB,OAAS,QACTuB,eAAiB,YACjBF,UAAUG,SAAS,4BACrBxB,OAAS,cACTuB,eAAiB,WAGnB9B,cAAc4B,WAAW,GAEzBtB,UAAUC,OAAQ,IAAI,SAAUyB,UAC9BhC,cAAc4B,WAAW,IAEzBI,SAAWC,KAAKC,MAAMF,UAAUA,UACnBZ,UAEXd,UAAU,SAAU,IAAI,SAAU0B,UAChCJ,UAAUO,QAAQ,QAAQC,KAAKJ,4BAGxBF,eAAgB,CACvBf,KAAM,UACNsB,UAAU,KAGVL,SAASM,sBAEFN,SAASO,QAAS,CACzBxB,KAAM,SACNsB,UAAU,EACVG,aAAa,OAIhB,WACDxC,cAAc4B,WAAW,kBAEhB,uBAAwB,CAC/Bb,KAAM,SACNsB,UAAU,EACVG,aAAa,8BAOjBjB,UAAUC,GAAG,QAAS,0EAA0E,SAAUC,GAC1GA,EAAEC,qCACA,qBAAqBC,aACnBC,WAAY,mBAAEC,MACdY,OAASb,UAAUhB,KAAK,eACxBI,KAAO,CACTyB,OAAQA,QAENlC,OAAS,aACTuB,eAAiB,cACjBF,UAAUG,SAAS,yBAA0B,CAC/CxB,OAAS,aACLuB,eAAiB,eAChB,GAAIF,UAAUG,SAAS,yBAA0B,CACtDxB,OAAS,aACLuB,eAAiB,UAGvB9B,cAAc4B,WAAW,GAEzBtB,UAAUC,OAAQS,MAAM,SAAUgB,cAChCA,SAAWC,KAAKC,MAAMF,UAAUA,WAChBA,SAASZ,QAAS,IAClB,cAAVb,OAAwB,qBAGxB,uCAAyCkC,OAAS,KAAKC,SAAS,UAAU9B,KAAK,OAAQ,yBAEvF,sCAAwC6B,OAAS,KAAKE,YAAY,8BAClE,sCAAwCF,OAAS,KAAKC,SAAS,8BAE/D,sCAAwCD,OAAS,KAAKC,SAAS,WAE7DE,aAAc,mBAAE,0CAA4CH,OAAS,MAC7DpC,KAAK,iBAAiBqC,SAAS,8BAEzC,mDAAqDD,OAAS,KAAKI,KAAK,QACrE,KAEDC,YAAa,mBAAE,uCAAyCL,OAAS,KACrEK,WAAWH,YAAY,cASnBC,YARAG,KAAOf,SAASgB,KAAKC,SAAWjB,SAASgB,KAAKC,SAAWjB,SAASgB,KAAKlC,IAC3EgC,WAAWlC,KAAK,OAAQmC,0BAEtB,sCAAwCN,OAAS,KAAKC,SAAS,8BAC/D,sCAAwCD,OAAS,KAAKE,YAAY,8BAElE,sCAAwCF,OAAS,KAAKE,YAAY,WAEhEC,aAAc,mBAAE,0CAA4CH,OAAS,MAC7DpC,KAAK,iBAAiBqC,SAAS,UAC3CE,YAAYvC,KAAK,6BAA6BsC,YAAY,8BAExD,mDAAqDF,OAAS,KAAKI,KAAKb,SAASgB,KAAKE,6BAIjFpB,eAAgB,CACvBf,KAAM,UACNsB,UAAU,IAGVL,UAAYA,SAASM,sBAGdN,SAASO,QAAS,CACzBxB,KAAM,SACNsB,UAAU,EACVG,aAAa,IAIZR,yBACM,iBAAkB,CACzBjB,KAAM,SACNsB,UAAU,EACVG,aAAa,IAMjBxC,cAAc4B,WAAW,MACxB,WAED5B,cAAc4B,WAAW,kBAGhB,iBAAkB,CACzBb,KAAM,SACNsB,UAAU,EACVG,aAAa,8BAQjBjB,UAAUC,GAAG,QAAS,oEAAoE,SAAUC,GACpGA,EAAEC,qCACA,qBAAqBC,aAEnBC,WAAY,mBAAEC,MACdtB,OAAS,WACTuB,eAAiB,cACjBF,UAAUG,SAAS,uBAAwB,CAC7CxB,OAAS,WACLuB,eAAiB,eAChB,GAAIF,UAAUG,SAAS,uBAAwB,CACpDxB,OAAS,WACLuB,eAAiB,UAGvB9B,cAAc4B,WAAW,GAEzBtB,UAAUC,OAdC,IAca,SAAUyB,cAChCA,SAAWC,KAAKC,MAAMF,UAAUA,WAChBA,SAASZ,QAAS,IAClB,YAAVb,2BAEA,uBAAuBmC,SAAS,8BAEhC,wBAAwBC,YAAY,eACjC,GAAc,YAAVpC,OAAsB,qBAE7B,wBAAwBmC,SAAS,8BAEjC,uBAAuBC,YAAY,8BAEnC,6BAA6BE,KAAKb,SAASmB,GAAGD,kBAC5CH,KAAOf,SAASmB,GAAGF,SAAWjB,SAASmB,GAAGF,SAAWjB,SAASmB,GAAGrC,wBACnE,0CAA0CF,KAAK,OAAQmC,UACpD,qBAEH,6BAA6BF,KAAKb,SAASmB,GAAGD,cAC5CH,KAAOf,SAASmB,GAAGF,SAAWjB,SAASmB,GAAGF,SAAWjB,SAASmB,GAAGrC,wBACnE,0CAA0CF,KAAK,OAAQmC,qBAGlDjB,eAAgB,CACvBf,KAAM,UACNsB,UAAU,IAIVL,UAAYA,SAASM,sBAEdN,SAASO,QAAS,CACzBxB,KAAM,SACNsB,UAAU,EACVG,aAAa,IAIZR,yBACM,iBAAkB,CACzBjB,KAAM,SACNsB,UAAU,EACVG,aAAa,IAMjBxC,cAAc4B,WAAW,MACxB,WAED5B,cAAc4B,WAAW,kBAEhB,uCAAwC,CAC/Cb,KAAM,SACNsB,UAAU,EACVG,aAAa"}