{"version":3,"file":"wordpress_sso_settings.min.js","sources":["../src/wordpress_sso_settings.js"],"sourcesContent":["/* eslint-disable jsdoc/require-jsdoc,no-console,max-len */\r\nimport $ from 'jquery';\r\n// import Notification from 'core/notification';\r\nimport {add as addToast} from 'core/toast';\r\nimport Config from 'core/config';\r\n\r\nexport function init() {\r\n  $('#admin-block_exaport_button_with_js').hide();\r\n  checkEnabledWpSSO();\r\n\r\n  $(document).on('click', '.block_exaport_request_wp_sso_passphrase, .block_exaport_remove_passphrase, .block_exaport_test_passphrase', function (e) {\r\n    e.preventDefault();\r\n\r\n    var theButton = $(this);\r\n\r\n    var action = '-NO-';\r\n    if (theButton.hasClass('block_exaport_request_wp_sso_passphrase')) {\r\n      action = 'requestPassphrase';\r\n    } else if (theButton.hasClass('block_exaport_remove_passphrase')) {\r\n      action = 'removePassphrase';\r\n    } else if (theButton.hasClass('block_exaport_test_passphrase')) {\r\n      action = 'testPassphrase';\r\n    }\r\n\r\n    var data = {\r\n      wp_action: action,\r\n      sesskey: Config.sesskey,\r\n    };\r\n\r\n    switch (action) {\r\n      case 'requestPassphrase':\r\n        var secret = $.trim($('.block_exaport_secret_input').val());\r\n        if (!secret) {\r\n          alert('Enter the secret!');\r\n          return false;\r\n        }\r\n        data.secret = secret;\r\n        break;\r\n      case 'removePassphrase':\r\n        break;\r\n      case 'testPassphrase':\r\n        break;\r\n    }\r\n\r\n    $.ajax({\r\n      url: M.cfg.wwwroot + '/blocks/exaport/importexport.php',\r\n      type: 'POST',\r\n      dataType: 'json',\r\n      data: data,\r\n      xhrFields: {withCredentials: true}   // keep Moodle session\r\n    })\r\n      .done(function (data) {\r\n        if (data.result === 'success') {\r\n          $('.block_exaport_message').replaceWith(data.html);\r\n        } else if (data.result === 'alert') {\r\n          addToast(data.message, {\r\n            type: 'success',       // 'success' | 'info' | 'warning' | 'danger'\r\n            autohide: true,        // disappears after a few seconds\r\n          });\r\n          /*notification.alert(\r\n            'Done',\r\n            data.message,\r\n            'Close'\r\n          );*/\r\n\r\n        } else if (data.result === 'error') {\r\n          addToast('Error <br>' + data.message, {\r\n            type: 'danger',       // 'success' | 'info' | 'warning' | 'danger'\r\n            autohide: false,        // disappears after a few seconds\r\n            closeButton: true,\r\n          });\r\n          /*notification.alert(\r\n            'Done',\r\n            'Error: ' + data.message,\r\n            'Close'\r\n          );*/\r\n          // alert('Error: ' + data.message);\r\n        }\r\n      })\r\n      .fail(function (jqXHR, textStatus, errorThrown) {\r\n        addToast('Something went wrong!', {\r\n          type: 'danger',       // 'success' | 'info' | 'warning' | 'danger'\r\n          autohide: false,        // disappears after a few seconds\r\n          closeButton: true,\r\n        });\r\n        console.log('error:', errorThrown, 'code: 1745419297633');\r\n        // alert('Something was wrong!');\r\n      });\r\n  });\r\n\r\n\r\n  $('body').on('change', '#id_s_block_exaport_wp_sso_enabled', function () {\r\n    checkEnabledWpSSO();\r\n  });\r\n\r\n  function checkEnabledWpSSO() {\r\n\r\n    // TODO: this doesn't work correclty, because moodle 4.5 changed the ids of the form fields!\r\n    // TODO: suggestion: remove this logic and don't hide the fields\r\n\r\n    var theValue = $('#id_s_block_exaport_wp_sso_enabled').prop('checked');\r\n\r\n    var relatedOptions = ['admin-wp_sso_url', 'admin-wp_sso_passphrase'];\r\n\r\n    if (theValue) {\r\n      // show related options\r\n      $(relatedOptions).each(function (i, elementId) {\r\n        $('#' + elementId).show(50);\r\n      });\r\n    } else {\r\n      // hide related options\r\n      $(relatedOptions).each(function (i, elementId) {\r\n        $('#' + elementId).hide(50);\r\n      });\r\n    }\r\n\r\n  }\r\n}\r\n"],"names":["checkEnabledWpSSO","relatedOptions","prop","each","i","elementId","show","hide","document","on","e","preventDefault","theButton","this","action","hasClass","data","wp_action","sesskey","Config","secret","$","trim","val","alert","ajax","url","M","cfg","wwwroot","type","dataType","xhrFields","withCredentials","done","result","replaceWith","html","message","autohide","closeButton","fail","jqXHR","textStatus","errorThrown","console","log"],"mappings":"qTA+FWA,wBAOHC,eAAiB,CAAC,mBAAoB,4BAF3B,mBAAE,sCAAsCC,KAAK,+BAMxDD,gBAAgBE,MAAK,SAAUC,EAAGC,+BAChC,IAAMA,WAAWC,KAAK,2BAIxBL,gBAAgBE,MAAK,SAAUC,EAAGC,+BAChC,IAAMA,WAAWE,KAAK,2BAzG5B,uCAAuCA,OACzCP,wCAEEQ,UAAUC,GAAG,QAAS,8GAA8G,SAAUC,GAC9IA,EAAEC,qBAEEC,WAAY,mBAAEC,MAEdC,OAAS,OACTF,UAAUG,SAAS,2CACrBD,OAAS,oBACAF,UAAUG,SAAS,mCAC5BD,OAAS,mBACAF,UAAUG,SAAS,mCAC5BD,OAAS,sBAGPE,KAAO,CACTC,UAAWH,OACXI,QAASC,gBAAOD,YAIX,sBADCJ,YAEAM,OAASC,gBAAEC,MAAK,mBAAE,+BAA+BC,WAChDH,cACHI,MAAM,sBACC,EAETR,KAAKI,OAASA,uBAQhBK,KAAK,CACLC,IAAKC,EAAEC,IAAIC,QAAU,mCACrBC,KAAM,OACNC,SAAU,OACVf,KAAMA,KACNgB,UAAW,CAACC,iBAAiB,KAE5BC,MAAK,SAAUlB,MACM,YAAhBA,KAAKmB,2BACL,0BAA0BC,YAAYpB,KAAKqB,MACpB,UAAhBrB,KAAKmB,sBACLnB,KAAKsB,QAAS,CACrBR,KAAM,UACNS,UAAU,IAQa,UAAhBvB,KAAKmB,uBACL,aAAenB,KAAKsB,QAAS,CACpCR,KAAM,SACNS,UAAU,EACVC,aAAa,OAUlBC,MAAK,SAAUC,MAAOC,WAAYC,4BACxB,wBAAyB,CAChCd,KAAM,SACNS,UAAU,EACVC,aAAa,IAEfK,QAAQC,IAAI,SAAUF,YAAa,iDAMvC,QAAQnC,GAAG,SAAU,sCAAsC,WAC3DT"}