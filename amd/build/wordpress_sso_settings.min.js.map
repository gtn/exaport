{"version":3,"file":"wordpress_sso_settings.min.js","sources":["../src/wordpress_sso_settings.js"],"sourcesContent":["/* eslint-disable jsdoc/require-jsdoc,no-console,max-len */\nimport $ from 'jquery';\n// import Notification from 'core/notification';\nimport {add as addToast} from 'core/toast';\nimport Config from 'core/config';\n\nexport function init() {\n  $('#admin-block_exaport_button_with_js').hide();\n  checkEnabledWpSSO();\n\n  $(document).on('click', '.block_exaport_request_wp_sso_passphrase, .block_exaport_remove_passphrase, .block_exaport_test_passphrase', function (e) {\n    e.preventDefault();\n\n    var theButton = $(this);\n\n    var action = '-NO-';\n    if (theButton.hasClass('block_exaport_request_wp_sso_passphrase')) {\n      action = 'requestPassphrase';\n    } else if (theButton.hasClass('block_exaport_remove_passphrase')) {\n      action = 'removePassphrase';\n    } else if (theButton.hasClass('block_exaport_test_passphrase')) {\n      action = 'testPassphrase';\n    }\n\n    var data = {\n      wp_action: action,\n      sesskey: Config.sesskey,\n    };\n\n    switch (action) {\n      case 'requestPassphrase':\n        var secret = $.trim($('.block_exaport_secret_input').val());\n        if (!secret) {\n          alert('Enter the secret!');\n          return false;\n        }\n        data.secret = secret;\n        break;\n      case 'removePassphrase':\n        break;\n      case 'testPassphrase':\n        break;\n    }\n\n    $.ajax({\n      url: M.cfg.wwwroot + '/blocks/exaport/importexport.php',\n      type: 'POST',\n      dataType: 'json',\n      data: data,\n      xhrFields: {withCredentials: true}   // keep Moodle session\n    })\n      .done(function (data) {\n        if (data.result === 'success') {\n          $('.block_exaport_message').replaceWith(data.html);\n        } else if (data.result === 'alert') {\n          addToast(data.message, {\n            type: 'success',       // 'success' | 'info' | 'warning' | 'danger'\n            autohide: true,        // disappears after a few seconds\n          });\n          /*notification.alert(\n            'Done',\n            data.message,\n            'Close'\n          );*/\n\n        } else if (data.result === 'error') {\n          addToast('Error <br>' + data.message, {\n            type: 'danger',       // 'success' | 'info' | 'warning' | 'danger'\n            autohide: false,        // disappears after a few seconds\n            closeButton: true,\n          });\n          /*notification.alert(\n            'Done',\n            'Error: ' + data.message,\n            'Close'\n          );*/\n          // alert('Error: ' + data.message);\n        }\n      })\n      .fail(function (jqXHR, textStatus, errorThrown) {\n        addToast('Something went wrong!', {\n          type: 'danger',       // 'success' | 'info' | 'warning' | 'danger'\n          autohide: false,        // disappears after a few seconds\n          closeButton: true,\n        });\n        console.log('error:', errorThrown, 'code: 1745419297633');\n        // alert('Something was wrong!');\n      });\n  });\n\n\n  $('body').on('change', '#id_s_block_exaport_wp_sso_enabled', function () {\n    checkEnabledWpSSO();\n  });\n\n  function checkEnabledWpSSO() {\n\n    // TODO: this doesn't work correclty, because moodle 4.5 changed the ids of the form fields!\n    // TODO: suggestion: remove this logic and don't hide the fields\n\n    var theValue = $('#id_s_block_exaport_wp_sso_enabled').prop('checked');\n\n    var relatedOptions = ['admin-wp_sso_url', 'admin-wp_sso_passphrase'];\n\n    if (theValue) {\n      // show related options\n      $(relatedOptions).each(function (i, elementId) {\n        $('#' + elementId).show(50);\n      });\n    } else {\n      // hide related options\n      $(relatedOptions).each(function (i, elementId) {\n        $('#' + elementId).hide(50);\n      });\n    }\n\n  }\n}\n"],"names":["checkEnabledWpSSO","relatedOptions","prop","each","i","elementId","show","hide","document","on","e","preventDefault","theButton","this","action","hasClass","data","wp_action","sesskey","Config","secret","$","trim","val","alert","ajax","url","M","cfg","wwwroot","type","dataType","xhrFields","withCredentials","done","result","replaceWith","html","message","autohide","closeButton","fail","jqXHR","textStatus","errorThrown","console","log"],"mappings":"qTA+FWA,wBAOHC,eAAiB,CAAC,mBAAoB,4BAF3B,mBAAE,sCAAsCC,KAAK,+BAMxDD,gBAAgBE,MAAK,SAAUC,EAAGC,+BAChC,IAAMA,WAAWC,KAAK,2BAIxBL,gBAAgBE,MAAK,SAAUC,EAAGC,+BAChC,IAAMA,WAAWE,KAAK,2BAzG5B,uCAAuCA,OACzCP,wCAEEQ,UAAUC,GAAG,QAAS,8GAA8G,SAAUC,GAC9IA,EAAEC,qBAEEC,WAAY,mBAAEC,MAEdC,OAAS,OACTF,UAAUG,SAAS,2CACrBD,OAAS,oBACAF,UAAUG,SAAS,mCAC5BD,OAAS,mBACAF,UAAUG,SAAS,mCAC5BD,OAAS,sBAGPE,KAAO,CACTC,UAAWH,OACXI,QAASC,gBAAOD,YAIX,sBADCJ,YAEAM,OAASC,gBAAEC,MAAK,mBAAE,+BAA+BC,WAChDH,cACHI,MAAM,sBACC,EAETR,KAAKI,OAASA,uBAQhBK,KAAK,CACLC,IAAKC,EAAEC,IAAIC,QAAU,mCACrBC,KAAM,OACNC,SAAU,OACVf,KAAMA,KACNgB,UAAW,CAACC,iBAAiB,KAE5BC,MAAK,SAAUlB,MACM,YAAhBA,KAAKmB,2BACL,0BAA0BC,YAAYpB,KAAKqB,MACpB,UAAhBrB,KAAKmB,sBACLnB,KAAKsB,QAAS,CACrBR,KAAM,UACNS,UAAU,IAQa,UAAhBvB,KAAKmB,uBACL,aAAenB,KAAKsB,QAAS,CACpCR,KAAM,SACNS,UAAU,EACVC,aAAa,OAUlBC,MAAK,SAAUC,MAAOC,WAAYC,4BACxB,wBAAyB,CAChCd,KAAM,SACNS,UAAU,EACVC,aAAa,IAEfK,QAAQC,IAAI,SAAUF,YAAa,iDAMvC,QAAQnC,GAAG,SAAU,sCAAsC,WAC3DT"}