{"version":3,"file":"wordpress_sso_settings.min.js","sources":["../src/wordpress_sso_settings.js"],"sourcesContent":["/* eslint-disable jsdoc/require-jsdoc,no-console,max-len */\r\nimport $ from 'jquery';\r\n// import Notification from 'core/notification';\r\nimport {add as addToast} from 'core/toast';\r\nimport Config from 'core/config';\r\nimport {get_string as getString} from 'core/str';\r\n\r\nexport function init() {\r\n  $('#admin-block_exaport_button_with_js').hide();\r\n  checkEnabledWpSSO();\r\n\r\n  $(document).on('click', '.block_exaport_request_wp_sso_passphrase, .block_exaport_remove_passphrase, .block_exaport_test_passphrase', function (e) {\r\n    e.preventDefault();\r\n\r\n    var theButton = $(this);\r\n\r\n    var action = '-NO-';\r\n    if (theButton.hasClass('block_exaport_request_wp_sso_passphrase')) {\r\n      action = 'requestPassphrase';\r\n    } else if (theButton.hasClass('block_exaport_remove_passphrase')) {\r\n      action = 'removePassphrase';\r\n    } else if (theButton.hasClass('block_exaport_test_passphrase')) {\r\n      action = 'testPassphrase';\r\n    }\r\n\r\n    var data = {\r\n      wp_action: action,\r\n      sesskey: Config.sesskey,\r\n    };\r\n\r\n    switch (action) {\r\n      case 'requestPassphrase':\r\n        var secret = $.trim($('.block_exaport_secret_input').val());\r\n        if (!secret) {\r\n          getString('wp_enter_secret', 'block_exaport').then(function(str) {\r\n            alert(str);\r\n          }).fail(function() {\r\n            alert('Enter the secret!');\r\n          });\r\n          return false;\r\n        }\r\n        data.secret = secret;\r\n        break;\r\n      case 'removePassphrase':\r\n        break;\r\n      case 'testPassphrase':\r\n        break;\r\n    }\r\n\r\n    $.ajax({\r\n      url: M.cfg.wwwroot + '/blocks/exaport/importexport.php',\r\n      type: 'POST',\r\n      dataType: 'json',\r\n      data: data,\r\n      xhrFields: {withCredentials: true}   // keep Moodle session\r\n    })\r\n      .done(function (data) {\r\n        if (data.result === 'success') {\r\n          $('.block_exaport_message').replaceWith(data.html);\r\n        } else if (data.result === 'alert') {\r\n          addToast(data.message, {\r\n            type: 'success',       // 'success' | 'info' | 'warning' | 'danger'\r\n            autohide: true,        // disappears after a few seconds\r\n          });\r\n          /*notification.alert(\r\n            'Done',\r\n            data.message,\r\n            'Close'\r\n          );*/\r\n\r\n        } else if (data.result === 'error') {\r\n          getString('error', 'core').then(function(errorStr) {\r\n            addToast(errorStr + ' <br>' + data.message, {\r\n              type: 'danger',       // 'success' | 'info' | 'warning' | 'danger'\r\n              autohide: false,        // disappears after a few seconds\r\n              closeButton: true,\r\n            });\r\n          }).fail(function() {\r\n            addToast('Error <br>' + data.message, {\r\n              type: 'danger',\r\n              autohide: false,\r\n              closeButton: true,\r\n            });\r\n          });\r\n          /*notification.alert(\r\n            'Done',\r\n            'Error: ' + data.message,\r\n            'Close'\r\n          );*/\r\n          // alert('Error: ' + data.message);\r\n        }\r\n      })\r\n      .fail(function (jqXHR, textStatus, errorThrown) {\r\n        getString('wp_something_went_wrong', 'block_exaport').then(function(str) {\r\n          addToast(str, {\r\n            type: 'danger',       // 'success' | 'info' | 'warning' | 'danger'\r\n            autohide: false,        // disappears after a few seconds\r\n            closeButton: true,\r\n          });\r\n        }).fail(function() {\r\n          addToast('Something went wrong!', {\r\n            type: 'danger',\r\n            autohide: false,\r\n            closeButton: true,\r\n          });\r\n        });\r\n        console.log('error:', errorThrown, 'code: 1745419297633');\r\n        // alert('Something was wrong!');\r\n      });\r\n  });\r\n\r\n\r\n  $('body').on('change', '#id_s_block_exaport_wp_sso_enabled', function () {\r\n    checkEnabledWpSSO();\r\n  });\r\n\r\n  function checkEnabledWpSSO() {\r\n\r\n    // TODO: this doesn't work correclty, because moodle 4.5 changed the ids of the form fields!\r\n    // TODO: suggestion: remove this logic and don't hide the fields\r\n\r\n    var theValue = $('#id_s_block_exaport_wp_sso_enabled').prop('checked');\r\n\r\n    var relatedOptions = ['admin-wp_sso_url', 'admin-wp_sso_passphrase'];\r\n\r\n    if (theValue) {\r\n      // show related options\r\n      $(relatedOptions).each(function (i, elementId) {\r\n        $('#' + elementId).show(50);\r\n      });\r\n    } else {\r\n      // hide related options\r\n      $(relatedOptions).each(function (i, elementId) {\r\n        $('#' + elementId).hide(50);\r\n      });\r\n    }\r\n\r\n  }\r\n}\r\n"],"names":["checkEnabledWpSSO","relatedOptions","prop","each","i","elementId","show","hide","document","on","e","preventDefault","theButton","this","action","hasClass","data","wp_action","sesskey","Config","secret","$","trim","val","then","str","alert","fail","ajax","url","M","cfg","wwwroot","type","dataType","xhrFields","withCredentials","done","result","replaceWith","html","message","autohide","errorStr","closeButton","jqXHR","textStatus","errorThrown","console","log"],"mappings":"qUAoHWA,wBAOHC,eAAiB,CAAC,mBAAoB,4BAF3B,mBAAE,sCAAsCC,KAAK,+BAMxDD,gBAAgBE,MAAK,SAAUC,EAAGC,+BAChC,IAAMA,WAAWC,KAAK,2BAIxBL,gBAAgBE,MAAK,SAAUC,EAAGC,+BAChC,IAAMA,WAAWE,KAAK,2BA7H5B,uCAAuCA,OACzCP,wCAEEQ,UAAUC,GAAG,QAAS,8GAA8G,SAAUC,GAC9IA,EAAEC,qBAEEC,WAAY,mBAAEC,MAEdC,OAAS,OACTF,UAAUG,SAAS,2CACrBD,OAAS,oBACAF,UAAUG,SAAS,mCAC5BD,OAAS,mBACAF,UAAUG,SAAS,mCAC5BD,OAAS,sBAGPE,KAAO,CACTC,UAAWH,OACXI,QAASC,gBAAOD,YAIX,sBADCJ,YAEAM,OAASC,gBAAEC,MAAK,mBAAE,+BAA+BC,WAChDH,iCACO,kBAAmB,iBAAiBI,MAAK,SAASC,KAC1DC,MAAMD,QACLE,MAAK,WACND,MAAM,yBAED,EAETV,KAAKI,OAASA,uBAQhBQ,KAAK,CACLC,IAAKC,EAAEC,IAAIC,QAAU,mCACrBC,KAAM,OACNC,SAAU,OACVlB,KAAMA,KACNmB,UAAW,CAACC,iBAAiB,KAE5BC,MAAK,SAAUrB,MACM,YAAhBA,KAAKsB,2BACL,0BAA0BC,YAAYvB,KAAKwB,MACpB,UAAhBxB,KAAKsB,sBACLtB,KAAKyB,QAAS,CACrBR,KAAM,UACNS,UAAU,IAQa,UAAhB1B,KAAKsB,4BACJ,QAAS,QAAQd,MAAK,SAASmB,yBAC9BA,SAAW,QAAU3B,KAAKyB,QAAS,CAC1CR,KAAM,SACNS,UAAU,EACVE,aAAa,OAEdjB,MAAK,0BACG,aAAeX,KAAKyB,QAAS,CACpCR,KAAM,SACNS,UAAU,EACVE,aAAa,UAWpBjB,MAAK,SAAUkB,MAAOC,WAAYC,iCACvB,0BAA2B,iBAAiBvB,MAAK,SAASC,oBACzDA,IAAK,CACZQ,KAAM,SACNS,UAAU,EACVE,aAAa,OAEdjB,MAAK,0BACG,wBAAyB,CAChCM,KAAM,SACNS,UAAU,EACVE,aAAa,OAGjBI,QAAQC,IAAI,SAAUF,YAAa,iDAMvC,QAAQtC,GAAG,SAAU,sCAAsC,WAC3DT"}