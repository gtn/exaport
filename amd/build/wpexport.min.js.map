{"version":3,"file":"wpexport.min.js","sources":["../src/wpexport.js"],"sourcesContent":["define(['jquery', 'core/notification', 'core/toast'], function($, notification, toast) {\n\n  const init = () => {\n\n    // Regular login button: silent creating of the wordpress account\n    $('body').on('click', '.exaport-wp-login, .exaport-wp-loginUpdate', function(e) {\n      e.preventDefault();\n      $('.exaport-wp-error').remove();\n      var theButton = $(this);\n      var action = 'login';\n      var successMessage = 'Logged in';\n      if (theButton.hasClass('exaport-wp-loginUpdate')) {\n        action = 'loginUpdate';\n        successMessage = 'Updated';\n      }\n      wpRequest(action, [], function(response) {\n        response = JSON.parse(response).response;\n        if (response.success) {\n          // get the form with WP functionality\n          wpRequest('wpForm', [], function(response) {\n            theButton.closest('form').html(response);\n          });\n          // showExaportToaster(successMessage);\n          toast.add(successMessage, {\n            type: 'success',       // 'success' | 'info' | 'warning' | 'danger'\n            autohide: true,        // disappears after a few seconds\n          });\n        }\n        if (response.error) {\n          // showExaportToaster(response.message, 'error');\n          toast.add(response.message, {\n            type: 'danger',       // 'success' | 'info' | 'warning' | 'danger'\n            autohide: false,        // disappears after a few seconds\n            closeButton: true,\n          });\n        }\n\n      }, function (result) {\n        toast.add('Error: 1745225660311', {\n          type: 'danger',       // 'success' | 'info' | 'warning' | 'danger'\n          autohide: false,        // disappears after a few seconds\n          closeButton: true,\n        });\n        // showExaportToaster('Error: 1745225660311', 'error');\n      } );\n    });\n\n  // send the view into WP\n    $('body').on('click', '.exaport-wp-viewExport, .exaport-wp-viewUpdate, .exaport-wp-viewRemove', function(e) {\n      e.preventDefault();\n      $('.exaport-wp-error').remove();\n      var theButton = $(this);\n      var viewId = theButton.attr('data-viewId');\n      var data = {\n        viewId: viewId\n      };\n      var action = 'viewExport';\n      var successMessage = 'Exported';\n      if (theButton.hasClass('exaport-wp-viewUpdate')) {\n        action = 'viewUpdate';\n        var successMessage = 'Updated';\n      } else if (theButton.hasClass('exaport-wp-viewRemove')) {\n        action = 'viewRemove';\n        var successMessage = 'Removed';\n      }\n      // rotate the icon\n      var buttonIcon = theButton.find('.exaport-icon');\n      buttonIcon.addClass('fa-spin');\n\n      wpRequest(action, data, function(response) {\n        response = JSON.parse(response).response;\n        if (response && response.success) {\n          if (action == 'viewRemove') {\n            // hide \"view\" button\n            // add/update 'view' button\n            $('.exaport-wp-viewPreview[data-viewId=' + viewId + ']').addClass('d-none').attr('href', '#');\n            // update the \"update\" button to \"export\"\n            $('.exaport-wp-viewExport[data-viewId=' + viewId + ']').removeClass('d-none');\n            $('.exaport-wp-viewUpdate[data-viewId=' + viewId + ']').addClass('d-none');\n            // remove \"remove\" button\n            $('.exaport-wp-viewRemove[data-viewId=' + viewId + ']').addClass('d-none');\n            // update icons - hide them at all\n            var iconWrapper = $('.wp-exported-icons-wrapper[data-viewId=' + viewId + ']');\n            iconWrapper.find('.exaport-icon').addClass('d-none');\n            // clear the date\n            $('.wp-exported-wptimemodified-wrapper[data-viewId=' + viewId + ']').text('');\n          } else {\n            // add/update 'view' button\n            var viewButton = $('.exaport-wp-viewPreview[data-viewId=' + viewId + ']');\n            viewButton.removeClass('d-none');\n            viewButton.attr('href', response.view.url);\n            // update the \"export\" button to \"update\"\n            $('.exaport-wp-viewExport[data-viewId=' + viewId + ']').addClass('d-none');\n            $('.exaport-wp-viewUpdate[data-viewId=' + viewId + ']').removeClass('d-none');\n            // show \"remove\" button\n            $('.exaport-wp-viewRemove[data-viewId=' + viewId + ']').removeClass('d-none');\n            // update icons\n            var iconWrapper = $('.wp-exported-icons-wrapper[data-viewId=' + viewId + ']');\n            iconWrapper.find('.exaport-icon').addClass('d-none');\n            iconWrapper.find('.exaport-icon.wp-exported').removeClass('d-none');\n            // change the date\n            $('.wp-exported-wptimemodified-wrapper[data-viewId=' + viewId + ']').text(response.view.timemodified);\n          }\n          // toaster\n          // showExaportToaster(successMessage);\n          toast.add(successMessage, {\n            type: 'success',       // 'success' | 'info' | 'warning' | 'danger'\n            autohide: true,        // disappears after a few seconds\n          });\n        }\n        if (response && response.error) {\n          // toaster\n          // showExaportToaster(response.message, 'error');\n          toast.add(response.message, {\n            type: 'danger',       // 'success' | 'info' | 'warning' | 'danger'\n            autohide: false,        // disappears after a few seconds\n            closeButton: true,\n          });\n          // theButton.after('<div class=\"alert alert-danger alert-sm .exaport-wp-error\">' + response.message + '</div>');\n        }\n        if (!response) {\n          toast.add('Request error!', {\n            type: 'danger',       // 'success' | 'info' | 'warning' | 'danger'\n            autohide: false,        // disappears after a few seconds\n            closeButton: true,\n          });\n          // showExaportToaster('Request error!', 'error');\n        }\n\n        // stop rotation\n        buttonIcon.removeClass('fa-spin');\n      }, function (result) {\n        // stop rotation\n        buttonIcon.removeClass('fa-spin');\n        // toaster\n        toast.add('Request error!', {\n          type: 'danger',       // 'success' | 'info' | 'warning' | 'danger'\n          autohide: false,        // disappears after a few seconds\n          closeButton: true,\n        });\n        // showExaportToaster('Request error!', 'error');\n      } );\n    });\n\n\n    // Send the CV into WP\n    $('body').on('click', '.exaport-wp-cvExport, .exaport-wp-cvUpdate, .exaport-wp-cvRemove', function(e) {\n      e.preventDefault();\n      $('.exaport-wp-error').remove();\n      var data = {};\n      var theButton = $(this);\n      var action = 'cvExport';\n      var successMessage = 'Exported';\n      if (theButton.hasClass('exaport-wp-cvUpdate')) {\n        action = 'cvUpdate';\n        var successMessage = 'Updated';\n      } else if (theButton.hasClass('exaport-wp-cvRemove')) {\n        action = 'cvRemove';\n        var successMessage = 'Removed';\n      }\n      // rotate the icon\n      var buttonIcon = theButton.find('.exaport-icon');\n      buttonIcon.addClass('fa-spin');\n\n      wpRequest(action, data, function(response) {\n        response = JSON.parse(response).response;\n        if (response && response.success) {\n          if (action == 'cvRemove') {\n            // hide Info block\n            $('.exaport-wp-cv-info').addClass('d-none');\n            // show \"export\" button\n            $('.exaport-wp-cvExport').removeClass('d-none');\n          } else if (action == 'cvExport') {\n            // hide export button\n            $('.exaport-wp-cvExport').addClass('d-none');\n            // show info block\n            $('.exaport-wp-cv-info').removeClass('d-none');\n            // update the data\n            $('.exaport-wp-cv-info .date').text(response.cv.timemodified);\n            $('.exaport-wp-cv-info .exaport-wp-cvView').attr('href', response.cv.url)\n          } else {\n            // update the data\n            $('.exaport-wp-cv-info .date').text(response.cv.timemodified);\n            $('.exaport-wp-cv-info .exaport-wp-cvView').attr('href', response.cv.url);\n          }\n          // toaster\n          toast.add(successMessage, {\n            type: 'success',       // 'success' | 'info' | 'warning' | 'danger'\n            autohide: true,        // disappears after a few seconds\n          });\n          // showExaportToaster(successMessage);\n        }\n        if (response && response.error) {\n          // toaster\n          toast.add(response.message, {\n            type: 'danger',       // 'success' | 'info' | 'warning' | 'danger'\n            autohide: false,        // disappears after a few seconds\n            closeButton: true,\n          });\n          // showExaportToaster(response.message, 'error');\n        }\n        if (!response) {\n          toast.add('Request error!', {\n            type: 'danger',       // 'success' | 'info' | 'warning' | 'danger'\n            autohide: false,        // disappears after a few seconds\n            closeButton: true,\n          });\n          // showExaportToaster('Request error!', 'error');\n        }\n\n        // stop rotation\n        buttonIcon.removeClass('fa-spin');\n      }, function (result) {\n        // stop rotation\n        buttonIcon.removeClass('fa-spin');\n        // toaster\n        toast.add('Request error (code: 1745230772232)!', {\n          type: 'danger',       // 'success' | 'info' | 'warning' | 'danger'\n          autohide: false,        // disappears after a few seconds\n          closeButton: true,\n        });\n        // showExaportToaster('Request error (code: 1745230772232)!', 'error');\n      } );\n    });\n\n\n  };\n\n  return { init };\n});\n\n\n\nfunction wpRequest(action, parameters, successFunction, failureFunction) {\n\n  var ajaxUrl = jQueryExaport('.exaport-wp-form').attr('data-ajaxUrl');\n\n  jQueryExaport.ajax({\n    url: ajaxUrl,\n    type: 'POST',\n    data: {\n      wpAction: 1,\n      parameters: parameters,\n      action: action\n    },\n    success: function (res) {\n      successFunction(res);\n    },\n    failure: function (res) {\n      failureFunction(res);\n    }\n  });\n\n}\n"],"names":["wpRequest","action","parameters","successFunction","failureFunction","ajaxUrl","jQueryExaport","attr","ajax","url","type","data","wpAction","success","res","failure","define","$","notification","toast","init","on","e","preventDefault","remove","theButton","this","successMessage","hasClass","response","JSON","parse","closest","html","add","autohide","error","message","closeButton","result","viewId","buttonIcon","find","addClass","removeClass","iconWrapper","text","viewButton","view","timemodified","cv"],"mappings":"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"}